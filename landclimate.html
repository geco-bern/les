<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Land in the Earth System - 7&nbsp; Land-climate interactions</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./ecohydrology.html" rel="next">
<link href="./globalcarbonpatterns.html" rel="prev">
<link href="./figures/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="Land in the Earth System - 7&nbsp; Land-climate interactions">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/geco-bern/les_i/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./landclimate.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Land-climate interactions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./biogeography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Biogeography</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./globalcarbonbudget.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The global carbon budget</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gpp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Gross primary production and photosynthesis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ecosystemcarbon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ecosystem carbon dynamics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./globalcarbonpatterns.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial and temporal patterns of the terrestrial carbon cycle</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./landclimate.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Land-climate interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ecohydrology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Ecohydrology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nutrients.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Carbon-nutrient cycle interactions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ghg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Terrestrial greenhouse gas emissions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oceancarbon.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Ocean CO<sub>2</sub> uptake and emission-concentration trajectories</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./globenvchange.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Global environmental change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedbacks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Earth system feedbacks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./landusechange.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Land use change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./researchtools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Research tools</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Reading</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#components-of-surface-radiation" id="toc-components-of-surface-radiation" class="nav-link active" data-scroll-target="#components-of-surface-radiation"><span class="header-section-number">7.1</span> Components of surface radiation</a>
  <ul class="collapse">
  <li><a href="#incident-shortwave-radiation" id="toc-incident-shortwave-radiation" class="nav-link" data-scroll-target="#incident-shortwave-radiation"><span class="header-section-number">7.1.1</span> Incident shortwave radiation</a></li>
  <li><a href="#outgoing-shortwave-radiation-and-albedo" id="toc-outgoing-shortwave-radiation-and-albedo" class="nav-link" data-scroll-target="#outgoing-shortwave-radiation-and-albedo"><span class="header-section-number">7.1.2</span> Outgoing shortwave radiation and albedo</a></li>
  <li><a href="#longwave-radiation" id="toc-longwave-radiation" class="nav-link" data-scroll-target="#longwave-radiation"><span class="header-section-number">7.1.3</span> Longwave radiation</a></li>
  </ul></li>
  <li><a href="#surface-energy-balance" id="toc-surface-energy-balance" class="nav-link" data-scroll-target="#surface-energy-balance"><span class="header-section-number">7.2</span> Surface energy balance</a>
  <ul class="collapse">
  <li><a href="#energy-partitioning" id="toc-energy-partitioning" class="nav-link" data-scroll-target="#energy-partitioning"><span class="header-section-number">7.2.1</span> Energy partitioning</a></li>
  <li><a href="#evaporative-fraction-and-bowen-ratio" id="toc-evaporative-fraction-and-bowen-ratio" class="nav-link" data-scroll-target="#evaporative-fraction-and-bowen-ratio"><span class="header-section-number">7.2.2</span> Evaporative fraction and Bowen ratio</a></li>
  </ul></li>
  <li><a href="#energy-fluxes-across-biomes" id="toc-energy-fluxes-across-biomes" class="nav-link" data-scroll-target="#energy-fluxes-across-biomes"><span class="header-section-number">7.3</span> Energy fluxes across biomes</a>
  <ul class="collapse">
  <li><a href="#diurnal-variations" id="toc-diurnal-variations" class="nav-link" data-scroll-target="#diurnal-variations"><span class="header-section-number">7.3.1</span> Diurnal variations</a></li>
  <li><a href="#seasonal-variations" id="toc-seasonal-variations" class="nav-link" data-scroll-target="#seasonal-variations"><span class="header-section-number">7.3.2</span> Seasonal variations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-landclimate" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Land-climate interactions</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In previous chapters, we have investigated the interactions between the atmosphere and the land surface through the exchange of CO<sub>2</sub>. In this, chapter, we focus on interactions through physical processes, including the radiative energy balance and heat fluxes at the land surface. Since these Earth system interactions are also mediated to a large degree through biology, they are referred to as <em>biogeophysical</em> processes. This is in contrast to the exchange of CO<sub>2</sub> and nutrient fluxes, referred to as <em>biogeochemical</em> processes.</p>
<p>The partitioning of heat fluxes into a sensible (hot air) and latent (moist air) heat flux is strongly affected by the availability of water for evaporation and transpiration. All aspects that relate to the water cycle, how it is affected by vegetation, and how it affects the surface energy balance and limits vegetation activity, are introduced in <a href="ecohydrology.html" class="quarto-xref"><span>Chapter 8</span></a>. However, land-climate interactions are also important in absence of effects by water limitation. The surface properties, determined by the land cover type, its roughness, and (for vegetation) its conduciveness to evaporating water, have a strong influence on the atmosphere and climatic conditions, especially near the. surface - where life happens. Climate and numerical weather prediction models require the fluxes of energy, momentum, and water vapour for simulating atmospheric processes. This chapter introduces how properties of the vegetated land surface affect these fluxes.</p>
<section id="components-of-surface-radiation" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="components-of-surface-radiation"><span class="header-section-number">7.1</span> Components of surface radiation</h2>
<p>Analogous to solar radiation being the “engine” of biogeochemical processes through its control on photosynthesis, net radiation is the engine of energy and water vapour fluxes between the atmosphere and the land surface. Net radiation (<span class="math inline">\(R_n\)</span>) is the net of incoming (or incident) shortwave radiation (<span class="math inline">\(S\downarrow\)</span>) minus outgoing shortwave (solar) radiation (<span class="math inline">\(S\uparrow\)</span>) and longwave radiation (<span class="math inline">\(L\downarrow\)</span> and <span class="math inline">\(L\uparrow\)</span>) at the land surface (<a href="#fig-netrad" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> a). <span id="eq-netrad"><span class="math display">\[
R_n = S\downarrow - S\uparrow + L\downarrow - L\uparrow
\tag{7.1}\]</span></span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-netrad" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-netrad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/energybalance.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-netrad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Land surface energy partitioning. (a) Components of net radiation. (b) Energy balance of the land surface.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="incident-shortwave-radiation" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="incident-shortwave-radiation"><span class="header-section-number">7.1.1</span> Incident shortwave radiation</h3>
<p>Incident shortwave (solar) radiation <span class="math inline">\(S\downarrow\)</span> was referred to in <a href="globalcarbonpatterns.html" class="quarto-xref"><span>Chapter 6</span></a> as <span class="math inline">\(I_\mathrm{0}\)</span>. (Nomenclature will be homogenized across chapters in future issues this book.) It varies over the course of a day and a year, and is affected by the presence of clouds and the altitude of the land surface above sea level, as described in <a href="globalcarbonpatterns.html" class="quarto-xref"><span>Chapter 6</span></a>. As shown in <a href="#fig-surface-energy-balance" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, the presence of clouds is a strong determinant of the incoming solar radiation energy flux, when considering global means (including the sea surface) under actual conditions and under cloud-free conditions (160 vs.&nbsp;214 W<sup>-2</sup>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-surface-energy-balance" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-surface-energy-balance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="https://www.ipcc.ch/report/ar6/wg1/downloads/figures/IPCC_AR6_WGI_Figure_7_2.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-surface-energy-balance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Schematic representation of the global mean energy budget of the Earth (upper panel), and its equivalent without considerations of cloud effects (lower panel). Numbers indicate best estimates for the magnitudes of the globally averaged energy balance components in W<sup>-2</sup> together with their uncertainty ranges in parentheses (5–95% confidence range), representing climate conditions at the beginning of the 21st century. Note that the cloud-free energy budget shown in the lower panel is not the one that Earth would achieve in equilibrium when no clouds could form. It rather represents the global mean fluxes as determined solely by removing the clouds but otherwise retaining the entire atmospheric structure. This enables the quantification of the effects of clouds on the Earth energy budget and corresponds to the way clear-sky fluxes are calculated in climate models. Thus, the cloud-free energy budget is not closed and therefore the sensible and latent heat fluxes are not quantified in the lower panel. Figure and caption from <span class="citation" data-cites="IPCC_2021_WGI_Ch_7">Forster et al. (<a href="references.html#ref-IPCC_2021_WGI_Ch_7" role="doc-biblioref">2021</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="outgoing-shortwave-radiation-and-albedo" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="outgoing-shortwave-radiation-and-albedo"><span class="header-section-number">7.1.2</span> Outgoing shortwave radiation and albedo</h3>
<p>Outgoing shortwave radiation at the land surface (<span class="math inline">\(S\uparrow\)</span>) is determined by the albedo (<span class="math inline">\(\alpha\)</span>) - the fraction of the incident radiation that gets reflected. <span id="eq-albedo"><span class="math display">\[
S\uparrow = \alpha S\downarrow
\tag{7.2}\]</span></span> The albedo varies across different vegetation and other types of Earth surface covers. Values range from 0.8-0.95 for fresh snow, to 0.2-0.45 for a desert surface, 0.05–0.40 for bare soil, 0.05-0.26 for vegetation, and 0.03–0.10 for water <span class="citation" data-cites="oke87">(<a href="references.html#ref-oke87" role="doc-biblioref">Oke 1987</a>)</span>. Variations across different vegetation types are substantial as shown also in <a href="#fig-albedo-vegtypes" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>. This indicates that the amount of outgoing shortwave radiation, and with it net radiation, is strongly affected by vegetation types.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data-raw/albedo_cescatti.csv"</span>))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">reorder</span>(vegtype, albedo_insitu, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> albedo_insitu</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"grey70"</span>) <span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Vegetation type"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Albedo"</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-albedo-vegtypes" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-albedo-vegtypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="landclimate_files/figure-html/fig-albedo-vegtypes-1.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-albedo-vegtypes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Albedo values for different vegetation types. Each point represents a site where surface radiation fluxes were measured. Vegetation types are described in <a href="biogeography.html#tbl-vegtype" class="quarto-xref">Table&nbsp;<span>2.1</span></a>. Data from <span class="citation" data-cites="cescatti12rse">Cescatti et al. (<a href="references.html#ref-cescatti12rse" role="doc-biblioref">2012</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The diurnal variation of albedo is U-shaped - high at sunrise and sunset, and lower in between. Over the seasons, land surface albedo is affected by variations in LAI and by the presence of snow. During winter and in the presence of snow, the albedo of a grassland or a cropland can reach very high values - determined by the albedo of snow. In contrast, the albedo of a forest, even in the presence of snow, remains. much lower (0.2-0.4, <span class="citation" data-cites="zhao14ecolmono">Zhao and Jackson (<a href="references.html#ref-zhao14ecolmono" role="doc-biblioref">2014</a>)</span>). This is because trees are not fully “submerged” in the snow pack, as opposed to grasses, and the exposed canopy absorbs a substantial fraction of the incident radiation. This effect of forest vs.&nbsp;non-forest covers on the surface energy balance during winter is referred to as the <em>snow masking effect</em>. Climate model simulations suggest that the low surface albedo during winter warms climate compared compared to a snow-covered grassland. Thus, deforestation/afforestation of boreal forest has the greatest biogeophysical effect of all biomes on temperatures <span class="citation" data-cites="bonan08sci">(<a href="references.html#ref-bonan08sci" role="doc-biblioref">G. B. Bonan 2008</a>)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-snow-masking" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-snow-masking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/snow_masking_bonan.jpg" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-snow-masking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Snow-free vs.&nbsp;snow-covered surface albedo for different vegetation types. Figure from <span class="citation" data-cites="bonan08sci">G. B. Bonan (<a href="references.html#ref-bonan08sci" role="doc-biblioref">2008</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Note that albedo also depends on the wavelength of the radiation, on the solar zenith angle (lower at noon), and on whether the solar radiation is diffuse or direct. Thus, albedo varies over time, <span class="math inline">\(\alpha\)</span> in <a href="#eq-albedo" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> represents the albedo for shortwave radiation, and values shown in <a href="#fig-albedo-vegtypes" class="quarto-xref">Figure&nbsp;<span>7.3</span></a> are averages across the seasons.</p>
</section>
<section id="longwave-radiation" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="longwave-radiation"><span class="header-section-number">7.1.3</span> Longwave radiation</h3>
<p>Every material body with a temperature above the absolute zero (0 K <span class="math inline">\(= -\)</span> 273.15°C) emits radiative energy. The total radiative energy flux (integrated across wavelengths) and the wavelengths at which radiation is emitted depend on the temperature of the body and its emissivity. The surface of the sun is about 6000 K and emits radiation in the shorwave spectrum which is visible to the human eye. The Earth surface is on average 288 K and emits radiation in the longwave spectrum which is not visible to the eye.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Formula for Planck's Law</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>calc_planck <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, temp){</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fl">6.626e-34</span>  <span class="co"># Planck’s constant</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> <span class="fl">3e8</span>        <span class="co"># speed of light</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fl">1.38e-23</span>   <span class="co"># Stefan Boltzmann constant</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>pi<span class="sc">*</span>h<span class="sc">*</span>c<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (lambda<span class="sc">^</span><span class="dv">5</span><span class="sc">*</span>(<span class="fu">exp</span>(h<span class="sc">*</span>c<span class="sc">/</span>(k<span class="sc">*</span>lambda<span class="sc">*</span>temp)) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_planck,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp =</span> <span class="dv">6000</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="fl">0.4e-5</span>) <span class="sc">+</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Sun"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"6000 K"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Wavelength (m)"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Emittance (W m"</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">" m"</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">")"</span>))</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_planck,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">temp =</span> <span class="dv">288</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="fl">1e-4</span>) <span class="sc">+</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Earth"</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"288 K"</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Wavelength (m)"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Emittance (W m"</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">" m"</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">")"</span>))</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  gg1,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  gg2,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-wavelengths" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wavelengths-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="landclimate_files/figure-html/fig-wavelengths-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wavelengths-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.5: Spectral distribution of the radiative energy flux (a) for a body of 6000 K (the sun) and (b) a body of 288 K (the earth), assuming an emissivity of 1. <em>Emittance</em> (the y-axis) is the density of the radiative energy flux per unit wavelength spectrum. Note the different magnitudes of the emittances and wavelengths for the two bodies. Example following <span class="citation" data-cites="bonan">G. Bonan (<a href="references.html#ref-bonan" role="doc-biblioref">2015</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>According to the Stefan-Boltzmann law, the total radiative energy flux scales with the temperature of the body <span class="math inline">\(T\)</span> and an emissivity <span class="math inline">\(\varepsilon\)</span>: <span id="eq-boltzmann"><span class="math display">\[
R = \varepsilon \sigma T^4
\tag{7.3}\]</span></span> <span class="math inline">\(\sigma\)</span> is the Stefan Boltzmann constant and has a value of <span class="math inline">\(5.670\times 10^{-8}\)</span> W m<sup>-2</sup> K<sup>-4</sup>. Here, <span class="math inline">\(T\)</span> is expressed in Kelvin. <span class="math inline">\(R\)</span> is the integral under the curve in <a href="#fig-wavelengths" class="quarto-xref">Figure&nbsp;<span>7.5</span></a>. <span class="math inline">\(R\)</span> stands for either longwave or shortwave radiation, as referred to as <span class="math inline">\(L\)</span> and <span class="math inline">\(S\)</span> in <a href="#eq-netrad" class="quarto-xref">Equation&nbsp;<span>7.1</span></a>.</p>
<p>The longwave radiation components are a substantial fraction of net radiation. In <a href="#fig-surface-energy-balance" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, they are referred to as “thermal”. The outgoing longwave radiation <span class="math inline">\(L\uparrow\)</span> is on average 398 W m<sup>-2</sup> and is a function of the Earth’s surface temperature and emissivity, following the Stefan-Boltzmann law (<a href="#eq-boltzmann" class="quarto-xref">Equation&nbsp;<span>7.3</span></a>), plus the incident longwave radiation reflected (not absorbed) by the surface: <span id="eq-longwave-up"><span class="math display">\[
L\uparrow = \varepsilon \sigma T^4 + (1-\varepsilon) L\downarrow
\tag{7.4}\]</span></span> Note that <span class="math inline">\(\varepsilon\)</span> is used in <a href="#eq-longwave-up" class="quarto-xref">Equation&nbsp;<span>7.4</span></a> as the absorbtivity and in <a href="#eq-boltzmann" class="quarto-xref">Equation&nbsp;<span>7.3</span></a> as the emissivity. This is because the two are equal.</p>
<p>Clouds absorb radiation emitted by the earth surface and re-emit a large fraction of it. In absence of clouds, much less radiation is absorbed and re-emitted by the atmosphere. Therefore, the incoming longwave radiation depends strongly on the presence of clouds.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Net radiation
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using <a href="#eq-albedo" class="quarto-xref">Equation&nbsp;<span>7.2</span></a> and <a href="#eq-longwave-up" class="quarto-xref">Equation&nbsp;<span>7.4</span></a>, the net radiation at the earth surface (<a href="#eq-netrad" class="quarto-xref">Equation&nbsp;<span>7.1</span></a>) can be expressed as <span class="math display">\[
R_n = (1-\alpha) S\downarrow + \varepsilon L\downarrow - \varepsilon \sigma T^4
\]</span></p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Calculate the albedo from ‘all sky’ conditions in <a href="#fig-surface-energy-balance" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>.</li>
</ol>
</div>
</div>
</section>
</section>
<section id="surface-energy-balance" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="surface-energy-balance"><span class="header-section-number">7.2</span> Surface energy balance</h2>
<p>The energy available from radiative fluxes is converted into a sensible heat flux (<span class="math inline">\(H\)</span>), a latent heat flux (<span class="math inline">\(\lambda E\)</span>), and a ground heat flux (<span class="math inline">\(G\)</span>, <a href="#fig-netrad" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> b). Following energy conservation, net radiation is equal to the sum of these three heat fluxes. <span id="eq-energybalance"><span class="math display">\[
R_n = H + \lambda E + G
\tag{7.5}\]</span></span></p>
<p>The components of the surface energy balance (<a href="#eq-energybalance" class="quarto-xref">Equation&nbsp;<span>7.5</span></a>) are commonly expressed in energy units (W m<sup>-2</sup>). Sensible heat is determined by the temperature of air. Latent heat is the energy contained by evaporated water. The latent heat flux (<span class="math inline">\(\lambda E\)</span>) can also be expressed as a mass flux of water vapour (<span class="math inline">\(E\)</span>). <span class="math inline">\(E\)</span> is the mass flux of water vapor, e.g., expressed in units of g m<sup>-2</sup> s<sup>-1</sup>. <span class="math inline">\(\lambda\)</span> is the latent heat of vaporization and converts the mass units into energy units. It measures how much energy (Joules, J) is needed vapourize 1 g of water at constant temperature. <span class="math inline">\(\lambda\)</span> is 2.466 MJ kg<sup>-1</sup> at 15°C and has a slight dependence on temperature, decreasing linearly by about 3% from an air temperature of 0°C to 30°C (see code below using the {bigleaf} R package <span class="citation" data-cites="knauer18plosone">(<a href="references.html#ref-knauer18plosone" role="doc-biblioref">Knauer et al. 2018</a>)</span>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bigleaf)  <span class="co"># This package contains lots of useful functions and parameters for land-atmosphere exchange. Reference: Knauer et al. 2018 https://dx.plos.org/10.1371/journal.pone.0201114</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">latent.heat.vaporization</span>(<span class="dv">30</span>) <span class="sc">/</span> <span class="fu">latent.heat.vaporization</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9715714</code></pre>
</div>
</div>
<p>The sensible and latent heat fluxes are transported vertically, away from or to the land surface through convective transport. That is, through turbulences that mix the air and lead to a net vertical transport of heat and water vapor. Whether net fluxes are pointed upwards or downwards depends on the sign of the net radiation (see fig xxx) and typically changes between night and daytime. Note that the latent heat flux can be negative, leading to a net flux of water vapor towards the surface. The respective water mass <em>condensates</em> at the surface (of leaves) and can be a considerable fraction of the ecosystem water balance. The ground heat flux <span class="math inline">\(G\)</span> buffers variations of net radiation, absorbing energy and removing heat from the surface during the day and summer and releasing heat during night and winter.</p>
<section id="energy-partitioning" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="energy-partitioning"><span class="header-section-number">7.2.1</span> Energy partitioning</h3>
<p>Physical and biological properties of the land surface determine not only the net radiation through (mainly) effects of the albedo, but also strongly influence the <em>partitioning</em> of net radiation into sensible and latent heat fluxes in <a href="#eq-energybalance" class="quarto-xref">Equation&nbsp;<span>7.5</span></a>. Thus, the spatial distribution of vegetation and other land cover types, and the response of plants to temporal changes in the environment (and thus on LAI and stomatal conductance) influence the energy partitioning at the land surface and near-surface atmospheric conditions. In other words, we have to understand vegetation and its response to the environment in order to understand land-climate interactions and near-surface climate.</p>
<p>The key properties influencing the partitioning into the sensible and latent heat flux are the aerodynamic conductance to heat transfer (<span class="math inline">\(G_\mathrm{ah}\)</span>) and the surface conductance to water vapor transport (<span class="math inline">\(G_\mathrm{sw}\)</span>). How they influence the latent heat flux is shown in <a href="#fig-penmanmonteith" class="quarto-xref">Figure&nbsp;<span>7.7</span></a>. The aerodynamic conductance depends on the roughness of the surface and on wind speed. Taller vegetation has a higher roughness and a higher aerodynamic conductance. Roughness also increases with LAI.</p>
<p>On vegetated surfaces, the surface conductance to water vapor transport is strongly influenced by the stomatal conductance (<span class="math inline">\(g_s\)</span>, <a href="gpp.html#eq-photo-fick" class="quarto-xref">Equation&nbsp;<span>4.5</span></a> and <a href="gpp.html#eq-transpiration" class="quarto-xref">Equation&nbsp;<span>4.11</span></a>) and by the LAI. Water evaporation from rock, soil, leaf, or branch surfaces contributes to surface conductance and occurs also from non-vegetated surfaces. In a closed canopy, surface conductance is dominated by the signal by stomatal conductance. When leaves are active and photosynthesizing (high light), and when water stress is low (high soil moisture, low VPD), stomatal conductance is high. How water availability and vegetation regulate stomatal conductance and thus the latent heat flux and energy partitioning at the land surface is introduced in <a href="ecohydrology.html" class="quarto-xref"><span>Chapter 8</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-surface-resistance" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-surface-resistance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/canopy_resistance.png" class="img-fluid figure-img" style="width:70.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-surface-resistance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.6: Surface resistance and normalized latent heat flux for different vegetation types. Normalization removes effects of different net radiation on latent heat fluxes. Canopy resistance is equivalent to the inverse of surface conductance described in this chapter. Figure from <span class="citation" data-cites="bonan08sci">G. B. Bonan (<a href="references.html#ref-bonan08sci" role="doc-biblioref">2008</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dependency of energy partitioning on conductances
</div>
</div>
<div class="callout-body-container callout-body">
<p>Given the atmospheric condition (net radiation <span class="math inline">\(R_n\)</span> and the vapor pressure deficit of the ambient air <span class="math inline">\(D_a\)</span>), the latent heat flux can be modelled following the Penman-Monteith equation: <span id="eq-pm"><span class="math display">\[
\lambda E = \frac{s(R_n - G) + \rho c_p D_a G_\mathrm{ah}}{s + \gamma (1 + G_\mathrm{ah}/G_\mathrm{sw})}
\tag{7.6}\]</span></span></p>
<ul>
<li><span class="math inline">\(s\)</span> is the slope of the saturation vapor pressure versus temperature curve (kPa K<sup>−1</sup>)</li>
<li><span class="math inline">\(\rho\)</span> is the density of air (kg m<sup>-3</sup>)</li>
<li><span class="math inline">\(c_p\)</span> is the heat capacity of dry air (J K<sup>−1</sup> kg<sup>−1</sup>)</li>
<li><span class="math inline">\(\gamma\)</span> is the psychrometric constant (kPa K<sup>−1</sup>)</li>
</ul>
<p>A derivation of the Penman-Monteith equation is given by <span class="citation" data-cites="bonan">G. Bonan (<a href="references.html#ref-bonan" role="doc-biblioref">2015</a>)</span>, Ch. 12.7.</p>
<p>With this, and given the atmospheric condition, we can visualise the dependency of the latent heat flux on the aerodynamic and the surface conductances. Let’s assume <span class="math inline">\(R_n =\)</span> 400 W m<sup>-1</sup>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bigleaf)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate latent heat flux using penman monteith</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>calc_le_pm <span class="ot">&lt;-</span> <span class="cf">function</span>(netrad, vpd, temp, g_ah, g_sw){</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ARGUMENTS</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># netrad: net radiation</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vpd: vapour pressure deficit</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># temp: ambient air temperature</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># patm: atmospheric pressure (kPa)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aerodynamic conductance to heat transport, in mass units (m s-1)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># surface conductance to water vapor transport, in mass units (m s-1)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># using standard atmospheric pressure</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  patm <span class="ot">&lt;-</span> <span class="fu">bigleaf.constants</span>()<span class="sc">$</span>pressure0 <span class="sc">*</span> <span class="fl">1e-3</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># slope of the saturation vapor pressure, using "Sonntag_1990" in Bigleaf</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">Esat.slope</span>(temp)<span class="sc">$</span>Delta</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># density of air</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  rho <span class="ot">&lt;-</span> <span class="fu">air.density</span>(temp, patm)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># heat capacity of dry air</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  cp <span class="ot">&lt;-</span> <span class="fu">bigleaf.constants</span>()<span class="sc">$</span>cp</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># psychrometric constant</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> <span class="fu">psychrometric.constant</span>(temp, patm)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># assuming G = 0; conductances are in mass units</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> (s <span class="sc">*</span> netrad <span class="sc">+</span> rho <span class="sc">*</span> cp <span class="sc">*</span> vpd <span class="sc">*</span> g_ah) <span class="sc">/</span> (s <span class="sc">+</span> gamma <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> g_ah <span class="sc">/</span> g_sw))</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># # test our function</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># calc_le_pm(</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   netrad = 100,</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   vpd = 1,</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   temp = 15,</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   g_ah = 0.1,  # mass units (m s-1)</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   g_sw = mol.to.ms(0.6, Tair = temp, pressure = patm, constants = bigleaf.constants())  # convert molar units (mol m-2 s-1) to mass units</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # test built-in function</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># potential.ET(</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   Gs_pot = 0.6,  # molar units (mol m-2 s-1)</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   Tair = 15,</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   pressure = bigleaf.constants()$pressure0 * 1e-3,</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   VPD = 1,</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   Ga = 0.1,  # mass units</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   Rn = 100,</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   approach = "Penman-Monteith"</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   )[,"LE_pot"]</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co"># plot vs aerodynamic conductance</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_ah =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.3</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">vpd =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">le =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>      g_ah,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>      vpd,</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">calc_le_pm</span>(</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">netrad =</span> <span class="dv">400</span>, </span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">vpd =</span> .y, </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        <span class="at">temp =</span> <span class="dv">15</span>, </span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        <span class="at">g_ah =</span> .x, </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">g_sw =</span> <span class="fu">mol.to.ms</span>(</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>          <span class="fl">0.6</span>, </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>          <span class="at">Tair =</span> <span class="dv">15</span>, </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>          <span class="at">pressure =</span>  <span class="fu">bigleaf.constants</span>()<span class="sc">$</span>pressure0 <span class="sc">*</span> <span class="fl">1e-3</span>, </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>          <span class="at">constants =</span> <span class="fu">bigleaf.constants</span>()</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>          ))</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(g_ah, le, <span class="at">color =</span> vpd, <span class="at">group =</span> vpd)) <span class="sc">+</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"VPD (kPa)"</span>) <span class="sc">+</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Aerodynamic conductance (m s"</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">")"</span>)),</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(lambda, <span class="fu">italic</span>(<span class="st">"E"</span>), <span class="st">" (W m"</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">")"</span>))</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a><span class="co"># plot vs surface conductance</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">g_sw =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="at">by =</span> <span class="fl">0.01</span>),</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">vpd =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">le =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>      g_sw,</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>      vpd,</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">calc_le_pm</span>(</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>        <span class="at">netrad =</span> <span class="dv">400</span>, </span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">vpd =</span> .y, </span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">temp =</span> <span class="dv">15</span>, </span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">g_ah =</span> <span class="fl">0.1</span>, </span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>        <span class="at">g_sw =</span> .x)</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(g_sw, le, <span class="at">color =</span> vpd, <span class="at">group =</span> vpd)) <span class="sc">+</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"VPD (kPa)"</span>) <span class="sc">+</span></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Surface conductance (m s"</span><span class="sc">^-</span><span class="dv">1</span>, <span class="st">")"</span>)),</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(lambda, <span class="fu">italic</span>(<span class="st">"E"</span>), <span class="st">" (W m"</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">")"</span>))</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>  gg1,</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>  gg2,</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>),</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.77</span>, <span class="dv">1</span>)</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-penmanmonteith" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-penmanmonteith-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="landclimate_files/figure-html/fig-penmanmonteith-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-penmanmonteith-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.7: Dependency of the latent heat flux on (a) the aerodynamic conductance and (b) the surface conductance following the Penman-Monteith equation (<a href="#eq-pm" class="quarto-xref">Equation&nbsp;<span>7.6</span></a>).
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-penmanmonteith" class="quarto-xref">Figure&nbsp;<span>7.7</span></a> shows an interesting interactive effect of aerodynamic conductance and the VPD of ambient air. At low VPD, plant transpiration is reduced, thus limiting the latent heat flux (<span class="math inline">\(\lambda E\)</span>). Under such conditions, the <span class="math inline">\(\lambda E\)</span> declines with increasing aerodynamic conductance. This is because <span class="math inline">\(H\)</span> rises faster than <span class="math inline">\(\lambda E\)</span> with increasing aerodynamic conductance and consumes a larger share of the net radiation. Under moderate-to-high VPD (above $$1 kPa in this example), <span class="math inline">\(\lambda E\)</span> rises with increasing aerodynamic conductance.</p>
<p>Under conditions of very low aerodynamic conductance (e.g., in a short-statured grassland that has a low surface roughness and under stable atmospheric conditions, e.g., during an inversion), the latent heat flux does not approach zero. This is because as long as there is positive net radiation (here 400 W m<sup>-2</sup>), the surface (skin temperature) heats up relative to the ambient air and creates a positive VPD at the leaf surface (even if VPD of ambient air is zero). These aspects drive a continued positive <span class="math inline">\(H\)</span> and <span class="math inline">\(\lambda E\)</span> and the rise of the surface boundary layer.</p>
</div>
</div>
</section>
<section id="evaporative-fraction-and-bowen-ratio" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="evaporative-fraction-and-bowen-ratio"><span class="header-section-number">7.2.2</span> Evaporative fraction and Bowen ratio</h3>
<p>When considering totals over longer periods of time (over at least one annual cycle), the ground heat flux can be neglected since the ground doesn’t gradually heat up over time. Hence, the sum of the latent and sensible heat fluxes add up to match net radiation. The <em>evaporative fraction</em> quantifies the fraction of available energy from net radiation goes into the latent heat flux. <span class="math display">\[
\mathrm{EF} = \lambda E/R_n
\]</span> The remainder goes into the sensible heat flux. The Bowen ratio expresses the same relation and is defined as <span class="math display">\[
B = H/\lambda E
\]</span> Quantifications of EF or <span class="math inline">\(B\)</span> give important insights beyond the “first-order control” by net radiation. Variations across space reflect surface properties and vegetation activity. In forests, the proportion of evapotranspiration to available energy is typically lower compared to certain crops, and it’s even lower in conifer forests than in deciduous broadleaf forests (<a href="#fig-surface-resistance" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>).</p>
</section>
</section>
<section id="energy-fluxes-across-biomes" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="energy-fluxes-across-biomes"><span class="header-section-number">7.3</span> Energy fluxes across biomes</h2>
<p>As for C fluxes in <a href="globalcarbonpatterns.html" class="quarto-xref"><span>Chapter 6</span></a>, we turn to investigating diurnal and seasonal patterns in fluxes - this time the energy fluxes. The patterns observed at the same sites as used before illustrate general differences across biomes and how different characteristics of the vegetation cover affect the surface energy balance and flux partitioning. In addition to the temperate broadleaved forest site (Hainich Forest, DE-Hai), we consider a coniferous forest (DE-Tha) and a grassland site (DE-Gri) that are located closeby (and thus experience largely identical meterological conditions, ignoring feedbacks from vegetation-atmosphere fluxes that affect near-surface climate).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_sites <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/fdk_site_info.csv"</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># chose representative sites</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>use_sites <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FI-Hyy"</span>, <span class="co"># Boreal Forests/Taiga</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DE-Hai"</span>, <span class="co"># Temperate Broadleaf &amp; Mixed Forests</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DE-Tha"</span>, <span class="co"># Temperate Coniferous</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DE-Gri"</span>, <span class="co"># Grassland just next to DE-Tha</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BR-Sa3"</span>, <span class="co"># Tropical</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"US-ICh"</span>  <span class="co"># Tundra</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># subset data</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>df_sites <span class="sc">|&gt;</span>  </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sitename <span class="sc">%in%</span> use_sites) <span class="sc">|&gt;</span> </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">lon =</span> <span class="fu">format</span>(lon, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">format</span>(lat, <span class="at">digits =</span> <span class="dv">3</span>), </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">elv =</span> <span class="fu">format</span>(elv, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Site =</span> sitename, </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Longitude =</span> lon, </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Latitude =</span> lat, </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Elevation =</span> elv, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Vegetation type</span><span class="st">`</span> <span class="ot">=</span> igbp_land_use,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Climate zone</span><span class="st">`</span> <span class="ot">=</span> koeppen_code</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-site-info" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-site-info-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Site</th>
<th style="text-align: left;">Longitude</th>
<th style="text-align: left;">Latitude</th>
<th style="text-align: left;">Elevation</th>
<th style="text-align: left;">Vegetation type</th>
<th style="text-align: left;">Climate zone</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BR-Sa3</td>
<td style="text-align: left;">-55.0</td>
<td style="text-align: left;">-3.02</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">EBF</td>
<td style="text-align: left;">Am</td>
</tr>
<tr class="even">
<td style="text-align: left;">DE-Gri</td>
<td style="text-align: left;">13.5</td>
<td style="text-align: left;">50.95</td>
<td style="text-align: left;">385</td>
<td style="text-align: left;">GRA</td>
<td style="text-align: left;">Cfb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DE-Hai</td>
<td style="text-align: left;">10.5</td>
<td style="text-align: left;">51.08</td>
<td style="text-align: left;">439</td>
<td style="text-align: left;">DBF</td>
<td style="text-align: left;">Cfb</td>
</tr>
<tr class="even">
<td style="text-align: left;">DE-Tha</td>
<td style="text-align: left;">13.6</td>
<td style="text-align: left;">50.96</td>
<td style="text-align: left;">380</td>
<td style="text-align: left;">ENF</td>
<td style="text-align: left;">Cfb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FI-Hyy</td>
<td style="text-align: left;">24.3</td>
<td style="text-align: left;">61.85</td>
<td style="text-align: left;">181</td>
<td style="text-align: left;">ENF</td>
<td style="text-align: left;">Dfc</td>
</tr>
<tr class="even">
<td style="text-align: left;">US-ICh</td>
<td style="text-align: left;">-149.3</td>
<td style="text-align: left;">68.61</td>
<td style="text-align: left;">940</td>
<td style="text-align: left;">OSH</td>
<td style="text-align: left;">ET</td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-site-info-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.8: Site meta information. Vegetation types are described in <a href="biogeography.html#tbl-vegtype" class="quarto-xref">Table&nbsp;<span>2.1</span></a>. Climate zones are described in <a href="biogeography.html#fig-table_beck" class="quarto-xref">Figure&nbsp;<span>2.22</span></a>.
</figcaption>
</figure>
</div>
</div>
<section id="diurnal-variations" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="diurnal-variations"><span class="header-section-number">7.3.1</span> Diurnal variations</h3>
<!-- The diurnal course of energy fluxes is considered for an average day in July for each site. The mid-day peak of net radiation is highest at the tropical site (BR-Sa3) and lowest at the tundra site (US-ICh). This reflects patterns in solar radiation (@fig-diurnal_cycle). Within the temperate sites, the mid-day peak is highest in the coniferous forest site and lowest in the grassland site. This reflects the differences in albedo between different vegetation cover types (@fig-albedo-vegtypes). Net radiation drops to negative values during the night. This is because solar radiation is zero and the land surface is warmer than the ambient air. This drives a negative (upward) heat flux, gradually cooling the surface during the course of the night. Within temperate sites, this night-time cooling is stronger at the forest sites (DE-Hai and DE-Tha) than at the grassland site (DE-Gri). -->
<div class="cell">
<div class="cell-output-display">
<div id="fig-energy-diurnal" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-energy-diurnal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/diurnal_cycle_radiation.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-energy-diurnal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.9: Diurnal variations of energy fluxes at sites representing different biomes, taken as the average for each half-hour of a day in July.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<p>The diurnal course of energy fluxes is considered for an average day in July for each site. Describe key patterns and differences between sites and relate them to your knowledge about radiation, energy partitioning, and land surface and vegetation properties.</p>
<ol start="2" type="1">
<li>How does net radiation compare across sites in the top row of <a href="#fig-energy-diurnal" class="quarto-xref">Figure&nbsp;<span>7.9</span></a>? What component of the net radiation (<a href="#fig-netrad" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> a) do you think is responsible for the observed differences? What surface property may contribute to the differences in net radiation and does it explain why the tropical site has a higher mid-day net radiation peak than the boreal site?</li>
<li>How does net radiation compare across the three sites in the temperate biome? Can vegetation properties that affect the reflectance explain why the mid-day peak net radiation is lower for DE-Gri han for DE-Tha?</li>
<li>During night-time, net radiation is negative at all sites. Which of the four components of net radiation is largest during nighttime?</li>
<li>Is the land surface losing or gaining energy during the night? What flux drives this gain/loss (<span class="math inline">\(H\)</span> or <span class="math inline">\(\lambda E\)</span>)?</li>
<li>At what site is the nighttime energy gain/loss highest? What surface property may be responsible for this?</li>
<li>Chararcterise the Bowen ratio at mid-day for all sites (greater than, close to, or smaller than 1).</li>
<li>What site has the highest mid-day Bowen ratio? What site has the lowest mid-day Bowen ratio?</li>
<li>Assuming all sites had the same aerodynamic and surface conductances, which site may have the highest mid-day VPD? Is this a valid assumption? If not, how do you expect conductances to differ among sites?</li>
<li>The temperate coniferous forest site (which one?) has the higher mid-day net radiation than the temperate broadleaved fores site (which one?). Yet, its latent heat flux is lower than for the latter. Assuming they had the same VPD and aerodynamic conductance, what other surface property may explain this difference?</li>
<li>The temperate grassland has a higher latent heat flux than the two temperate forest sites. Can the difference in vegetation height explain the difference in the latent heat flux?</li>
<li>What site has the highest sensible heat flux? If you were a paraglider, over which site do you expect to find the strongest up-lift to take you to your next destination?</li>
</ol>
</div>
</div>
<!-- At the tundra and the boreal site, the Bowen ratio is near one throughout the day, indicating an equal split between $H$ and $\lambda E$. At the tropical forest site, the latent heat flux is much higher than the sensible heat flux. This is likely due to a higher VPD at mid-day at BR-Sa3 than at the other sites, combined with differences in stomatal conductance (and therefore surface conductance) and vegetation height (and therefore roughness and aerodynamic conductance). -->
<!-- Differences among the three temperate sites are also interesting. Despite a higher net radiation, the latent heat flux is lower at the coniferous forest site DE-Tha than at the beech (broadleaf) forest site DE-Hai. This may be due to generally more conservative water use of coniferous trees (gymnosperms) and is related to their water transport system which is distinct from angiosperms (to which beech belongs). Among the temperate sites, the grassland (DE-Gri) shows the highest latent heat flux - despite being short-statured and thus having a lower aerodynamic conductance than its forest counterparts and the same meteorological conditions  -->
<!-- XXX LES 2:  -->
<!-- - investigate the drivers of LE being higher than H at the tropical forest site, but not in other forests. -->
<!-- - investigate differences in LE between DE-Hai and DE-Tha (is VPD the cause of differences?) -->
</section>
<section id="seasonal-variations" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="seasonal-variations"><span class="header-section-number">7.3.2</span> Seasonal variations</h3>
<div class="cell">
<div class="cell-output-display">
<div id="fig-energy-seasonal" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-energy-seasonal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/seasonal_cycle_radiation.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-energy-seasonal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.10: Seasonal variations of energy fluxes at sites representing different biomes.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
</div>
<div class="callout-body-container callout-body">
<ol start="12" type="1">
<li>Which site has the highest net radiation around May? What surface property may this be related to?</li>
<li>Which site has the lowest summertime net radiation? How does this compare to differences in summertime solar radiation among these sites? What other components of net radiation do you expect to explain the low summertime net radiation at this site?</li>
<li>What could explain the different seasonal course of the latent and sensible heat flux at DE-Hai, while they vary in parallel at DE-Tha?</li>
<li>What may be the cause of the delayed springtime increase of <span class="math inline">\(\lambda E\)</span>, compared to <span class="math inline">\(H\)</span> at FI-Hyy?</li>
<li>What site loses the largest amount of water on an annual basis?</li>
<li>Do you find other interesting patterns and interpretable differences between sites?</li>
</ol>
</div>
</div>
<!-- ## Big-leaf model for energy exchange -->
<!-- - Diffusion equations for sensible and latent heat -->
<!-- - Surface temperature -->
<!-- ## Microclimates -->
<!-- - Rebetez data -->
<!-- Variations over time (for a given location) reflect changes in water limitation on vegetation activity. -->
<!-- indicative of the degree of water stress on  -->
<!-- Exercise: -->
<!-- - Express the sensible heat flux as a function of net radiation and the evaporative fraction -->
<!-- - Express the EF as a function of the Bowen ratio. -->
<!-- - aerodynamic conductance to heat transfer: AT-Neu (grassland) isrelatively poorly coupled, whereas DE-Tha (forest) shows a high degree of coupling. -->
<!-- Outgoing shortwave radiation is determined by the shortwave *albedo* ($\alpha$) of the surface. Longwave radiation is emitted by the atmosphere, determining $L\downarrow$, and by the land surface, determining $L_\uparrow$.  -->
<!-- - Land surface temperatures -->
<!--   - "In western Europe, forest and agricultural land have comparable surface radiative temperature when soil is moist but respond differently to drought (30). Forest maintains green vegetation, as indicated by the normalized difference vegetation index, although surface temperature and sensible heat flux increase with drought. Vegetation greenness in cropland declines by ~50%, the surface warms 13°C more than in forest, and the drought enhancement in sensible heat flux is greater than for forest. The different response to drought arises from the deep roots of trees and their access to deeper reservoirs of soil water." (Bonan 2008) -->
<!-- - Differences in land-climate interactions across biomes and vegetation types -->
<!--   - Tropical forests -->
<!--     - High rates of ET -->
<!--     - "Flux tower measurements in the Brazilian Amazon confirm that forests have lower albedo compared with pasture, greater net radiation, and greater evapotranspiration, particularly during the dry season (11, 12), producing a shallow, cool, and moist boundary layer." (Bonan 2008) -->
<!--     - "Conifer forests have low summertime evaporative fraction (defined as the ratio of latent heat flux to available energy) compared with deciduous broadleaf forests, producing high rates of sensible heat exchange and deep atmospheric boundary layers (21)."  (Bonan 2008) -->
<!-- - Land use change: -->
<!--   - Small scale heterogeneity of deforestation can influence convergence -->
<!-- XXX exercise:  -->
<!-- 2. How much water is evaporated and transpired per day (kg m^-2^ d^1^) in mid-summer at the site DE-Hai assuming an air temperature of 15°C? Express the mass flux as a "depth", converting the units of mass per ground area in kg m^-2^ into a "depth" in mm. -->
<!-- - Bala et al. PNAS -->
<!-- https://www.dora.lib4ri.ch/wsl/islandora/object/wsl%3A16555/datastream/PDF/Rebetez-2018-Meteorological_data_series_from_Swiss-%28published_version%29.pdf -->
<!-- ## Water-carbon coupling {#sec-watercarbon} -->
<!-- ## Ecosystem water balance {#sec-waterbalance} -->
<!-- ## Surface energy balance {#sec-energybalance} -->
<!-- Surface energy budget: figures in IPCC AR6 p 932 -->
<!-- - Water-carbon trade-off -->
<!-- Wright et al., 2003: Least-Cost Input Mixtures of Water and Nitrogen for Photosynthesis -->
<!-- Prentice et al., 2014 doi: 10.1111/ele.12211 -->
<!-- - FvCB model -->
<!-- Lambers 2008 Ch 2 (textbooks/lambers08bookchapter_photosynthesis.pdf) -->
<!-- - Stomatal regulation -->
<!-- Bonan et al., 2014 doi:10.5194/gmd-7-2193-2014 -->
<!-- - Soil physics, water flow -->
<!-- Bonan 9 -->
<!-- - Plant hydraulics -->
<!-- Sperry & Love, 2015 doi: 10.1111/nph.13354 -->
<!-- - Land surface energy partitioning -->
<!--     - 2-source model -->
<!-- - Surface water balance, evapotranspiration 2 -->
<!-- Bonan 10 -->
<!--     - Bucket model and water stress curves (Teuling et al., Stocker et al., 2023) -->
<!--     - Priestly-Taylor -->
<!--         - surface-air temperature difference, see Ning Dong et al., 2013 GEB DOI: 10.1111/geb.12614 -->
<!--     - Penman-Monteith Eq -->
<!--     Bonan 12.7 -->
<!-- - Canopy light absorption -->
<!--     - Albedo -->
<!--     - Radiative transfer and light extinction (Beer-Lambert Law) -->
<!-- - Big-leaf model (Knauer et al., 2018) -->


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bonan" class="csl-entry" role="listitem">
Bonan, Gordon. 2015. <em>Ecological Climatology: Concepts and Applications</em>. 3rd ed. Cambridge University Press.
</div>
<div id="ref-bonan08sci" class="csl-entry" role="listitem">
Bonan, Gordon B. 2008. <span>“Forests and <span>Climate</span> <span>Change</span>: <span>Forcings</span>, <span>Feedbacks</span>, and the <span>Climate</span> <span>Benefits</span> of <span>Forests</span>.”</span> <em>Science</em> 320 (5882): 1444–49. <a href="https://doi.org/10.1126/science.1155121">https://doi.org/10.1126/science.1155121</a>.
</div>
<div id="ref-cescatti12rse" class="csl-entry" role="listitem">
Cescatti, Alessandro, Barbara Marcolla, Suresh K. Santhana Vannan, Jerry Yun Pan, Miguel O. Román, Xiaoyuan Yang, Philippe Ciais, et al. 2012. <span>“Intercomparison of <span>MODIS</span> Albedo Retrievals and in Situ Measurements Across the Global <span>FLUXNET</span> Network.”</span> <em>Remote Sensing of Environment</em> 121 (June): 323–34. <a href="https://doi.org/10.1016/j.rse.2012.02.019">https://doi.org/10.1016/j.rse.2012.02.019</a>.
</div>
<div id="ref-IPCC_2021_WGI_Ch_7" class="csl-entry" role="listitem">
Forster, P., T. Storelvmo, K. Armour, W. Collins, J.-L. Dufresne, D. Frame, D. J. Lunt, et al. 2021. <span>“The Earth’s Energy Budget, Climate Feedbacks, and Climate Sensitivity.”</span> Book Section. In <em>Climate Change 2021: The Physical Science Basis. Contribution of Working Group i to the Sixth Assessment Report of the Intergovernmental Panel on Climate Change</em>, edited by V. Masson-Delmotte, P. Zhai, A. Pirani, S. L. Connors, C. Péan, S. Berger, N. Caud, et al. Cambridge, UK; New York, NY, USA: Cambridge University Press. <a href="https://doi.org/10.1017/9781009157896.009">https://doi.org/10.1017/9781009157896.009</a>.
</div>
<div id="ref-knauer18plosone" class="csl-entry" role="listitem">
Knauer, Jürgen, Tarek S. El-Madany, Sönke Zaehle, and Mirco Migliavacca. 2018. <span>“Bigleaf—<span>An</span> <span>R</span> Package for the Calculation of Physical and Physiological Ecosystem Properties from Eddy Covariance Data.”</span> Edited by Ben Bond-Lamberty. <em>PLOS ONE</em> 13 (8): e0201114. <a href="https://doi.org/10.1371/journal.pone.0201114">https://doi.org/10.1371/journal.pone.0201114</a>.
</div>
<div id="ref-oke87" class="csl-entry" role="listitem">
Oke, T. R. 1987. <em>Boundary <span>Layer</span> <span>Climates</span></em>. 2nd ed. London: Routledge. <a href="https://doi.org/10.4324/9780203407219">https://doi.org/10.4324/9780203407219</a>.
</div>
<div id="ref-zhao14ecolmono" class="csl-entry" role="listitem">
Zhao, Kaiguang, and Robert B. Jackson. 2014. <span>“Biophysical Forcings of Land-Use Changes from Potential Forestry Activities in <span>North</span> <span>America</span>.”</span> <em>Ecological Monographs</em> 84 (2): 329–53. <a href="https://www.jstor.org/stable/43187893">https://www.jstor.org/stable/43187893</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./globalcarbonpatterns.html" class="pagination-link" aria-label="Spatial and temporal patterns of the terrestrial carbon cycle">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Spatial and temporal patterns of the terrestrial carbon cycle</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./ecohydrology.html" class="pagination-link" aria-label="Ecohydrology">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Ecohydrology</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>