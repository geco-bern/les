<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Land in the Earth System I - 4&nbsp; Ecosystem carbon fluxes and global patterns</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./carboncycle_3.html" rel="next">
<link href="./carboncycle_1.html" rel="prev">
<link href="./figures/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="Land in the Earth System I - 4&nbsp; Ecosystem carbon fluxes and global patterns">
<meta name="twitter:description" content="">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/geco-bern/R_book_template/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./carboncycle_2.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ecosystem carbon fluxes and global patterns</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this book</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./biogeography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Biogeography</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./carboncycle_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Global carbon pools and fluxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./carboncycle_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ecosystem carbon fluxes and global patterns</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./carboncycle_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ocean CO<sub>2</sub> uptake and emission-concentration trajectories</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./nutrients.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Carbon-nutrient cycle interactions and multiple greenhouse gas emissions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./landclimate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Land-climate interactions and water-carbon coupling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ecohydrology.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Ecohydrology</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./globenvchange.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Global environmental change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./feedbacks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Earth system feedbacks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./landusechange.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Land use change</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reading</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-photosynthesis" id="toc-sec-photosynthesis" class="nav-link active" data-scroll-target="#sec-photosynthesis"><span class="header-section-number">4.1</span> Photosynthesis</a>
  <ul class="collapse">
  <li><a href="#light-use-efficiency-model" id="toc-light-use-efficiency-model" class="nav-link" data-scroll-target="#light-use-efficiency-model"><span class="header-section-number">4.1.1</span> Light use efficiency model</a></li>
  <li><a href="#solar-radiation" id="toc-solar-radiation" class="nav-link" data-scroll-target="#solar-radiation"><span class="header-section-number">4.1.2</span> Solar radiation</a></li>
  <li><a href="#sec-light-absorption" id="toc-sec-light-absorption" class="nav-link" data-scroll-target="#sec-light-absorption"><span class="header-section-number">4.1.3</span> Canopy light absorption</a></li>
  <li><a href="#light-use-efficiency-and-photosynthesis" id="toc-light-use-efficiency-and-photosynthesis" class="nav-link" data-scroll-target="#light-use-efficiency-and-photosynthesis"><span class="header-section-number">4.1.4</span> Light use efficiency and photosynthesis</a></li>
  <li><a href="#farquhar-von-caemmerer-berry-model" id="toc-farquhar-von-caemmerer-berry-model" class="nav-link" data-scroll-target="#farquhar-von-caemmerer-berry-model"><span class="header-section-number">4.1.5</span> Farquhar-von Caemmerer-Berry model</a></li>
  <li><a href="#sec-stomatal-regulation" id="toc-sec-stomatal-regulation" class="nav-link" data-scroll-target="#sec-stomatal-regulation"><span class="header-section-number">4.1.6</span> Stomatal regulation</a></li>
  <li><a href="#sec-c4" id="toc-sec-c4" class="nav-link" data-scroll-target="#sec-c4"><span class="header-section-number">4.1.7</span> C<sub>4</sub> photosynthesis</a></li>
  <li><a href="#isotopic-fractionation" id="toc-isotopic-fractionation" class="nav-link" data-scroll-target="#isotopic-fractionation"><span class="header-section-number">4.1.8</span> Isotopic fractionation</a></li>
  </ul></li>
  <li><a href="#sec-carboncycle_ecosystem" id="toc-sec-carboncycle_ecosystem" class="nav-link" data-scroll-target="#sec-carboncycle_ecosystem"><span class="header-section-number">4.2</span> Ecosystem C dynamics</a>
  <ul class="collapse">
  <li><a href="#sec-npp" id="toc-sec-npp" class="nav-link" data-scroll-target="#sec-npp"><span class="header-section-number">4.2.1</span> Net primary productivity</a></li>
  <li><a href="#allocation" id="toc-allocation" class="nav-link" data-scroll-target="#allocation"><span class="header-section-number">4.2.2</span> Allocation</a></li>
  <li><a href="#turnover" id="toc-turnover" class="nav-link" data-scroll-target="#turnover"><span class="header-section-number">4.2.3</span> Turnover</a></li>
  <li><a href="#the-c-cascade" id="toc-the-c-cascade" class="nav-link" data-scroll-target="#the-c-cascade"><span class="header-section-number">4.2.4</span> The C cascade</a></li>
  </ul></li>
  <li><a href="#sec-global-patterns" id="toc-sec-global-patterns" class="nav-link" data-scroll-target="#sec-global-patterns"><span class="header-section-number">4.3</span> Spatial and temporal patterns of the global C cycle</a>
  <ul class="collapse">
  <li><a href="#global-patterns-in-gpp" id="toc-global-patterns-in-gpp" class="nav-link" data-scroll-target="#global-patterns-in-gpp"><span class="header-section-number">4.3.1</span> Global patterns in GPP</a></li>
  <li><a href="#seasonal-cycle" id="toc-seasonal-cycle" class="nav-link" data-scroll-target="#seasonal-cycle"><span class="header-section-number">4.3.2</span> Seasonal cycle</a></li>
  <li><a href="#diurnal-cycle" id="toc-diurnal-cycle" class="nav-link" data-scroll-target="#diurnal-cycle"><span class="header-section-number">4.3.3</span> Diurnal cycle</a></li>
  <li><a href="#breathing-of-the-earth" id="toc-breathing-of-the-earth" class="nav-link" data-scroll-target="#breathing-of-the-earth"><span class="header-section-number">4.3.4</span> Breathing of the Earth</a></li>
  <li><a href="#global-patterns-in-soil-and-vegetation-c" id="toc-global-patterns-in-soil-and-vegetation-c" class="nav-link" data-scroll-target="#global-patterns-in-soil-and-vegetation-c"><span class="header-section-number">4.3.5</span> Global patterns in soil and vegetation C</a></li>
  <li><a href="#peatlands" id="toc-peatlands" class="nav-link" data-scroll-target="#peatlands"><span class="header-section-number">4.3.6</span> Peatlands</a></li>
  <li><a href="#permafrost" id="toc-permafrost" class="nav-link" data-scroll-target="#permafrost"><span class="header-section-number">4.3.7</span> Permafrost</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-carboncycle_2" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Ecosystem carbon fluxes and global patterns</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In <a href="carboncycle_1.html" class="quarto-xref"><span>Chapter 3</span></a>, we conceived the global carbon cycle as a system of three pools (atmosphere, land, ocean), emissions as fluxes into the system (added to the atmosphere). and fluxes between the pools. The C dynamics in the land biosphere were modeled using a 1-box model which receives C inputs through photosynthesis and loses C through a constant turnover. In this chapter, we are un-boxing this model to better understand the input flux through photosynthesis in <a href="#sec-photosynthesis" class="quarto-xref"><span>Section 4.1</span></a> and the C dynamics and fluxes at the level of an ecosystem in <a href="#sec-carboncycle_ecosystem" class="quarto-xref"><span>Section 4.2</span></a>. This un-boxing is essential for understanding global patterns in <a href="#sec-global-patterns" class="quarto-xref"><span>Section 4.3</span></a>.</p>
<section id="sec-photosynthesis" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-photosynthesis"><span class="header-section-number">4.1</span> Photosynthesis</h2>
<section id="light-use-efficiency-model" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="light-use-efficiency-model"><span class="header-section-number">4.1.1</span> Light use efficiency model</h3>
<p><span class="citation" data-cites="monteith72">Monteith (<a href="references.html#ref-monteith72" role="doc-biblioref">1972</a>)</span> made the observation that the biomass productivity of a given (well-watered) crop (in the tropics) scales linearly with the amount of absorbed solar radiation, integrated over weeks to months. This observation underlies the general light use efficiency (LUE) model which describes ecosystem-level apparent photosynthesis (referred to as <em>gross primary production</em>, GPP) as the photosynthetic photon flux density (PPFD) and the efficiency at which photons are used for assimilating C (LUE). <span id="eq-luemodel"><span class="math display">\[
\mathrm{GPP} = \mathrm{PPFD} \cdot \mathrm{fAPAR} \cdot \mathrm{LUE}
\tag{4.1}\]</span></span> PPFD is the same as the also commonly used photosynthetically active radiation (PAR), but is expressed in moles of photons instead of energy units.</p>
<p>Of course, a relationship with biomass productivity, as observed by <span class="citation" data-cites="monteith72">Monteith (<a href="references.html#ref-monteith72" role="doc-biblioref">1972</a>)</span> should not be equated with a relationship with GPP. However, again, over longer periods of time, a given plant converts assimilated carbon into biomass at a relatively constant rate (see <a href="#sec-npp" class="quarto-xref"><span>Section 4.2.1</span></a>). Therefore, the observation by <span class="citation" data-cites="monteith72">Monteith (<a href="references.html#ref-monteith72" role="doc-biblioref">1972</a>)</span> is instructive for our understanding. Indeed, models of terrestrial GPP are often formulated in the form of <a href="#eq-luemodel" class="quarto-xref">Equation&nbsp;<span>4.1</span></a> and are useful for estimating how GPP values over space and time (at the scale of weeks to months). The aspect that the observations by <span class="citation" data-cites="monteith72">Monteith (<a href="references.html#ref-monteith72" role="doc-biblioref">1972</a>)</span> were made under well-watered conditions is a further caveat. However, it shall serve us in this chapter as we are - for now - ignoring the effects by limited root-zone water availability. We will relieve this simplification in <a href="landclimate.html" class="quarto-xref"><span>Chapter 7</span></a> and <a href="ecohydrology.html" class="quarto-xref"><span>Chapter 8</span></a>.</p>
<p>The linear dependence of GPP on PPFD implies that the variations of solar radiation over the seasons and across latitude directly translate to how GPP varies across these scales. This will be further described in <a href="#sec-global-patterns" class="quarto-xref"><span>Section 4.3</span></a>. Note that at shorter time scales, GPP is no longer linearly related to PAR.</p>
<p>In the following, we delve deeper into each of the three factors of <a href="#eq-luemodel" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>. Brace yourself. This will take us from the Earth’s orbit in space to the scale of a cell where photosynthetic CO<sub>2</sub> assimilation happens.</p>
</section>
<section id="solar-radiation" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="solar-radiation"><span class="header-section-number">4.1.2</span> Solar radiation</h3>
<p>PPFD is a fraction of the solar radiation at the top of the atmosphere (<span class="math inline">\(I_\mathrm{TOA}\)</span>). This fraction depends on the planetary albedo for visible light (<span class="math inline">\(\alpha_v\)</span>, unitless), an atmospheric attenuation factor (<span class="math inline">\(\tau\)</span>, unitless) that accounts for the elevation (<span class="math inline">\(z\)</span>)-dependent path length of a light ray travelling through the atmosphere and a factor that accounts for cloud cover <span class="math inline">\(f_c\)</span>. A further reduction by about 50% arises because photosynthesis uses only a range of the spectrum of wavelengths of solar radiation, corresponding to the visible light spectrum. The factor <span class="math inline">\(f_{p}\)</span> accounts for this and for the conversion of <span class="math inline">\(I_\mathrm{TOA}\)</span>, expressed as an energy flux in W m<sup>-2</sup>, to a flux of photons in mol s<sup>-1</sup> m<sup>-2</sup>. <span id="eq-ppfd"><span class="math display">\[
\mathrm{PPFD} = (1-\alpha_{v})\; \tau(z, f_c) \; f_{p}  \; I_\mathrm{TOA}
\tag{4.2}\]</span></span></p>
<p>Solar radiation across the full short-wave spectrum emitted by the sun and incident at the land surface (top-of-canopy, <span class="math inline">\(I_\mathrm{0}\)</span>) is similarly related to <span class="math inline">\(I_\mathrm{TOA}\)</span>. A different albedo applies for total short-wave radiation vs.&nbsp;the radiation in the photosynthetically active (and visible) spectrum. <span class="math inline">\(I_\mathrm{0}\)</span> is commonly expressed in energy units (W m<sup>-2</sup>). <span id="eq-sin"><span class="math display">\[
I_\mathrm{0} = (1-\alpha_\mathrm{sw})\; \tau(z, f_c) \; I_\mathrm{TOA}
\tag{4.3}\]</span></span></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-solar_radiation" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-solar_radiation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/solar_radiation_chelsa.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-solar_radiation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Map of solar radiation incident at the Earth surface, averaged over 1981-2010, based on <span class="citation" data-cites="chelsa_bioclim">Brun et al. (<a href="references.html#ref-chelsa_bioclim" role="doc-biblioref">2022</a>)</span>. Figure from <a href="https://en.wikipedia.org/wiki/Solar_irradiance#/media/File:RSDS_wiki.png">https://en.wikipedia.org/wiki/Solar_irradiance#/media/File:RSDS_wiki.png</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="solar-geometry" class="level4" data-number="4.1.2.1">
<h4 data-number="4.1.2.1" class="anchored" data-anchor-id="solar-geometry"><span class="header-section-number">4.1.2.1</span> Solar geometry</h4>
<p>Let’s first step outside the atmosphere and focus on the solar geometry to understand <span class="math inline">\(I_\mathrm{TOA}\)</span>. Solar geometry describes the cyclical movement of the Earth around the sun and how the resulting cyclically varying amount of solar energy that reaches the Earth. The top-of-the atmosphere perspective is relevant to separate atmospheric effects from planetary effects.</p>
<p><span class="math inline">\(I_\mathrm{TOA}\)</span> scales in proportion with the solar constant <span class="math inline">\(I_S\)</span> (1360.8 W m<sup>-2</sup>) and is inversely proportional to the square of the distance between the Earth and the sun (<span class="math inline">\(r_E\)</span>). <span id="eq-s-toa"><span class="math display">\[
I_\mathrm{TOA} = I_S r_E^{-2} \cos \theta_z
\tag{4.4}\]</span></span> <span class="math inline">\(\theta_z\)</span> is the solar zenith angle. The term <span class="math inline">\(\cos \theta_z\)</span> accounts for the dependence of the solar radiation on the angle at which the sun’s rays reach the Earth surface (no terrain considered). It varies cyclically over the course of a day (with <em>hour-of-day</em>) and over the course of a year (with <em>day-of-year</em>). The zenith angle is zero when the sun is directly above the observer - in the zenith (<a href="#fig-solar_geometry" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>). At this point, the intensity of the solar radiation is at its maximum.</p>
<p>Note that <span class="math inline">\(r_E\)</span> is not constant over the course of a year as the Earth rotates around the sun not following a perfect circle but an ellipse.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-solar_geometry" class="quarto-figure quarto-figure-center quarto-float anchored" width="80%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-solar_geometry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/solar_geometry.png" id="fig-solar_geometry" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-solar_geometry-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2
</figcaption>
</figure>
</div>
</div>
</div>
<p>The dependence of the solar zenith angle on the hour-of-day, day-of-year, and the latitude is described by <span id="eq-solar-zenith-angle"><span class="math display">\[
\cos \theta_z = \sin \varphi \sin \delta +\cos \varphi \cos \delta \cos h
\tag{4.5}\]</span></span></p>
<ul>
<li><span class="math inline">\(\varphi\)</span> is the local latitude in radians (0 at the equator, <span class="math inline">\(\pi/2\)</span> at the poles)</li>
<li><span class="math inline">\(\delta\)</span> is the solar declination angle. It accounts for the tilt of the Earth relative to the plane in which it moves around the sun. It varies with the day-of-year (<span class="math inline">\(23.5^\circ \pi/180\)</span> on the northern-hemispheric summer solstice, June 21, and <span class="math inline">\(-23.5^\circ \pi/180\)</span> on the northern-hemispheric winter solstice, December 21)</li>
<li><span class="math inline">\(h\)</span> is the solar hour angle. It varies with the hour-of-day (0 at solar noon, <span class="math inline">\(\pi\)</span> at “solar midnight”, <span class="math inline">\(\pi/12\)</span> at 1 hour after solar noon).</li>
</ul>
<p>A derivation of <a href="#eq-solar-zenith-angle" class="quarto-xref">Equation&nbsp;<span>4.5</span></a> is given on <a href="https://en.wikipedia.org/wiki/Solar_zenith_angle">Wikipedia</a>.</p>
</section>
<section id="variations-in-solar-radiation" class="level4" data-number="4.1.2.2">
<h4 data-number="4.1.2.2" class="anchored" data-anchor-id="variations-in-solar-radiation"><span class="header-section-number">4.1.2.2</span> Variations in solar radiation</h4>
<p>Variations in the solar zenith angle, as expressed through <a href="#eq-solar-zenith-angle" class="quarto-xref">Equation&nbsp;<span>4.5</span></a>, are shown for different latitudes and a mid-summer diurnal cycle in <a href="#fig-zenith" class="quarto-xref">Figure&nbsp;<span>4.3</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>calc_cos_zenith_angle <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    lat, <span class="co"># latitude in degrees</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    doy, <span class="co"># day of year (1-365)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    hod  <span class="co"># hour of day (0-24, 12 is solar noon)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  doy_summer_solstice <span class="ot">&lt;-</span> <span class="dv">173</span> <span class="co"># day-of-year of summer solstice (21 Jun)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  decl <span class="ot">&lt;-</span> <span class="fl">23.5</span> <span class="sc">*</span> <span class="fu">cos</span>((doy <span class="sc">-</span> doy_summer_solstice) <span class="sc">/</span> <span class="dv">365</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  phi <span class="ot">&lt;-</span> lat <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">180</span> <span class="co"># latitude in radians</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  hour_angle <span class="ot">&lt;-</span> (hod <span class="sc">-</span> <span class="dv">12</span>) <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  cos_zenith_angle <span class="ot">&lt;-</span> <span class="fu">sin</span>(phi) <span class="sc">*</span> <span class="fu">sin</span>(decl) <span class="sc">+</span> <span class="fu">cos</span>(phi) <span class="sc">*</span> <span class="fu">cos</span>(decl) <span class="sc">*</span> <span class="fu">cos</span>(hour_angle)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># limit to zero - sun disappears behind the horizon</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  cos_zenith_angle <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(cos_zenith_angle <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, cos_zenith_angle)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cos_zenith_angle)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Solar azimuth -------</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co"># at NH summer solstice (doy = 173)</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># at equator</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"Equator"</span>),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_cos_zenith_angle, </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="dv">0</span>,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">doy =</span> <span class="dv">173</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># at tropic (lat = 23.5)</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"23.5° N"</span>),</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_cos_zenith_angle, </span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="fl">23.5</span>,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">doy =</span> <span class="dv">173</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># at polar (lat = 66.5)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"66.5° N"</span>),</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_cos_zenith_angle, </span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="fl">66.5</span>,</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">doy =</span> <span class="dv">173</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># at north pole</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">"North pole"</span>),</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> calc_cos_zenith_angle, </span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">lat =</span> <span class="dv">90</span>,</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">doy =</span> <span class="dv">173</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">24</span>) <span class="sc">+</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">12</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"Equator"</span>, <span class="st">"23.5° N"</span>, <span class="st">"66.5° N"</span>, <span class="st">"North pole"</span>),</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cosine of solar zenith angle"</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Summer solstice (21 June)"</span>,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Hour of day"</span>,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-zenith" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-zenith-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-zenith-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zenith-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Cosine of the solar zenith angle at the solar noon and at the northern hemispheric summer solstice for different latitudes. The solar noon (here at 12.00) is indicated by the dotted line.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The areas under the curves in <a href="#fig-zenith" class="quarto-xref">Figure&nbsp;<span>4.3</span></a> are proportional to the daily total solar radiation. Calculating daily totals involves a few integrals. The derivation is not shown here, but is explained in <span class="citation" data-cites="davis17gmd">Davis et al. (<a href="references.html#ref-davis17gmd" role="doc-biblioref">2017</a>)</span>. Daily totals and their variation over the seasons are shown below in <a href="#fig-daily_stoa" class="quarto-xref">Figure&nbsp;<span>4.4</span></a> and <a href="#fig-stoa_hovmoeller" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use function calc_daily_solar() from Davis et al., 2017 GMD</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"R/solar.R"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Daily total and daytime-average S_TOA ---------------------</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for 4 different latitudes</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">365</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s_toa =</span> <span class="fu">calc_daily_solar</span>(<span class="dv">0</span>, doy)<span class="sc">$</span>ra_j.m2,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">dayl =</span> <span class="fu">calc_daily_solar</span>(<span class="dv">0</span>, doy)<span class="sc">$</span>hs_deg <span class="sc">*</span> <span class="fl">24.0</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">lat =</span> <span class="dv">0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">365</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">s_toa =</span> <span class="fu">calc_daily_solar</span>(<span class="fl">23.5</span>, doy)<span class="sc">$</span>ra_j.m2,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">dayl =</span> <span class="fu">calc_daily_solar</span>(<span class="fl">23.5</span>, doy)<span class="sc">$</span>hs_deg <span class="sc">*</span> <span class="fl">24.0</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">lat =</span> <span class="fl">23.5</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">365</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">s_toa =</span> <span class="fu">calc_daily_solar</span>(<span class="fl">66.5</span>, doy)<span class="sc">$</span>ra_j.m2,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">dayl =</span> <span class="fu">calc_daily_solar</span>(<span class="fl">66.5</span>, doy)<span class="sc">$</span>hs_deg <span class="sc">*</span> <span class="fl">24.0</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">lat =</span> <span class="fl">66.5</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">365</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">s_toa =</span> <span class="fu">calc_daily_solar</span>(<span class="dv">90</span>, doy)<span class="sc">$</span>ra_j.m2,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">dayl =</span> <span class="fu">calc_daily_solar</span>(<span class="dv">90</span>, doy)<span class="sc">$</span>hs_deg <span class="sc">*</span> <span class="fl">24.0</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">60</span> <span class="sc">/</span> <span class="dv">180</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">lat =</span> <span class="dv">90</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s_toa_daily_avg =</span> s_toa <span class="sc">/</span> dayl)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">Daily total</span><span class="st">`</span> <span class="ot">=</span> s_toa, <span class="st">`</span><span class="at">Daytime mean</span><span class="st">`</span> <span class="ot">=</span> s_toa_daily_avg) <span class="sc">|&gt;</span> </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">"Daily total"</span>, <span class="st">"Daytime mean"</span>), <span class="at">values_to =</span> <span class="st">"s_"</span>, <span class="at">names_to =</span> <span class="st">"var"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(doy, s_, <span class="at">color =</span> <span class="fu">as.factor</span>(lat))) <span class="sc">+</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">173</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Equator"</span>, <span class="st">"23.5° N"</span>, <span class="st">"66.5° N"</span>, <span class="st">"North pole"</span>),</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top-of-atmosphere solar radiation"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Day of year"</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Radiative energy flux (J m"</span><span class="sc">^-</span><span class="dv">2</span>, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(var), </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">color =</span> <span class="cn">NA</span>),</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-daily_stoa" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-daily_stoa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-daily_stoa-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-daily_stoa-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Daily total top-of-atmosphere solar radiation in J m<sup>-2</sup>. The summer solstice (21 June) is indicated by the dotted line. Note that the curves are not perfectly symmetrical with respect to the summer solstice line. This is because the Earth moves around the sun on an ellipse and hence the distance between the Earth and the sun varies over the year. The distance is at its minimum near the southern-hemispheric summer solstice. Therefore, the mid-summer maximum solar radiation at the southern tropic (23.5° S) is slightly higher than the mid-summer maximum solar radiation at the northern tropic (23.5° N).
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of day-of-year and latitude</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">365</span>, <span class="at">by =</span> <span class="dv">2</span>), </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s_toa =</span> <span class="fu">calc_daily_solar</span>(lat, doy)<span class="sc">$</span>ra_j.m2)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> doy,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> lat,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> s_toa)) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"magma"</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top-of-atmosphere solar radiation"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Daily total, year 2000"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Day of year"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude (°N)"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"J m"</span><span class="sc">^-</span><span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-stoa_hovmoeller" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stoa_hovmoeller-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-stoa_hovmoeller-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stoa_hovmoeller-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: Daily total top-of-atmosphere solar radiation in J m<sup>-2</sup> by latitude and day-of-year.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The diurnal (over the course of a day) and seasonal patterns in top-of-atmosphere solar radiation, following from solar geometry and expressed through <a href="#eq-solar-zenith-angle" class="quarto-xref">Equation&nbsp;<span>4.5</span></a>, have direct consequences for CO<sub>2</sub> uptake patterns, as expressed through <a href="#eq-luemodel" class="quarto-xref">Equation&nbsp;<span>4.1</span></a>, <a href="#eq-ppfd" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>, and <a href="#eq-s-toa" class="quarto-xref">Equation&nbsp;<span>4.4</span></a> and described further in <a href="#sec-global-patterns" class="quarto-xref"><span>Section 4.3</span></a>.</p>
<p>Some features are particularly noteworthy about the patterns in <span class="math inline">\(I_\mathrm{TOA}\)</span>:</p>
<ul>
<li>The diurnal variation of the instantaneous flux is largest in the tropics.</li>
<li>The seasonal variation of the daily total flux is largest at the north pole.</li>
<li>At the summer solstice, the daily total solar radiation is largest at the north pole, …</li>
<li>… but the daily maximum instantaneous and the daytime mean radiation flux are lower at the north pole than at the equator at the summer solstice.</li>
</ul>
<p>The biology of plants is attuned to the solar radiation patterns across different latitudes. The photosynthetic apparatus is constructed to make best use of the light, even during the hours of peak light intensity at mid-day. The phenological phases of plant growth reflect the light distribution over the seasons - evergreen plants dominate in the moist tropics to make use of the light year-round, while deciduous leaf strategies and annual life history strategies dominate in the northern latitudes where the seasonal fluctuation of light is large.</p>
<!-- XXX to add: -->
<!-- - Solar geometry for a sloped surface -->
</section>
<section id="long-term-variations-in-solar-radiation" class="level4" data-number="4.1.2.3">
<h4 data-number="4.1.2.3" class="anchored" data-anchor-id="long-term-variations-in-solar-radiation"><span class="header-section-number">4.1.2.3</span> Long-term variations in solar radiation</h4>
<p><em>Solar irradiance</em></p>
<p>The solar constant <span class="math inline">\(I_S\)</span> isn’t actually constant but varies on the order of 0.1% of the course of a <em>solar cycle</em>. One cycle is approximately 11 years. The cyclic behavior is related to the periodic flip of the sun’s magnetic field and the number of sunspots. The radiation emitted from the sun and the number of sunspots are at their minimum after a magnetic flip. There is also a small long-term trend in the solar radiation, having increased by &lt;0.1% since the Maunder Minimum (1645–1715). Solar irradiance is measured at high altitude to minimize the influence of the atmosphere (<span class="math inline">\(\tau\)</span> in Eq. <a href="#eq-ppfd" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>) and get information about how <span class="math inline">\(I_S\)</span> varies. Reconstructions of solar irradiance changes for the pre-instrumental period are based on the relationship between <span class="math inline">\(I_S\)</span> and the (easily observable) sunspot number. Variations in <span class="math inline">\(I_S\)</span> are small and do not have a dominant effect on climate and the carbon cycle that would override other forcings, especially for the industrial period <span class="citation" data-cites="IPCC_2021_WGI_SPM">(<a href="references.html#ref-IPCC_2021_WGI_SPM" role="doc-biblioref">IPCC 2021</a>)</span>.</p>
<p><em>Volcanic activity</em></p>
<p>Volcanic eruptions can influence the solar radiation at the Earth surface. Events that reduce solar radiation by more than 1 W m<sup>-2</sup> occur approximately every 35-40 years <span class="citation" data-cites="IPCC_2021_WGI_Ch_2">(<a href="references.html#ref-IPCC_2021_WGI_Ch_2" role="doc-biblioref">Gulev et al. 2021</a>)</span> and affect climate and the carbon cycle for up to a few years after very large eruptions. The increased aerosol load in the atmosphere reduces the total radiative energy flux (reducing <span class="math inline">\(\tau\)</span> in Eq. <a href="#eq-ppfd" class="quarto-xref">Equation&nbsp;<span>4.2</span></a>). However, through the strong positive effect of the aerosol load on the share of diffuse versus direct radiation, volcanic aerosols can affect the terrestrial carbon cycle, (somehow surprisingly) leading to a greater land C sink following years of large volcanic eruptions (<a href="#sec-light-absorption" class="quarto-xref"><span>Section 4.1.3</span></a>).</p>
<p><em>Orbital parameters</em></p>
<p>The largest changes in <span class="math inline">\(I_\mathrm{TOA}\)</span> arise over millennial time scales and are related to variations in Earth’s orbit around the sun. These <em>Milankovic cycles</em> are the trigger for the large climate swings between ice ages and warm periods over the course of ~100,000 years. Variations in the orbital parameters affect the latitudinal and seasonal distribution of <span class="math inline">\(I_\mathrm{TOA}\)</span>. Orbital parameters that vary periodically are:</p>
<ul>
<li>The <em>eccentricity</em> of the Earth’s elliptical orbit which affects the distance between the Earth and the sun, affecting <span class="math inline">\(I_\mathrm{TOA}\)</span> via <span class="math inline">\(r_E\)</span> in <a href="#eq-s-toa" class="quarto-xref">Equation&nbsp;<span>4.4</span></a>. It varies with a period of approximately 100,000 years.</li>
<li>The <em>obliquity</em> - the tilt of the axis of the Earth’s own rotation relative to the plane in which the Earth rotates around the sun. A greater obliquity amplifies seasonal variations in <span class="math inline">\(I_\mathrm{TOA}\)</span>. The obliquity is currently at 23.44°. At its minimum, it’s at 21.1°. Obliquity varies over 41,000 years.</li>
<li>The <em>precession</em> is the rotation of the Earth’s own rotation axis itself. The effect of precession, in combination with the fact that the Earth’s orbit is elliptical, is that the variation of the sun-Earth distance shifts over the seasons. It varies with a period of about 25,700 years.</li>
</ul>
<p>The point of minimal distance coinciding with the summer solstice leads to the largest mid-summer radiation maximum. As a result, the incident solar radiation over the northern-hemispheric summer at 65°N varied by about 83 W m<sup>-2</sup> during the past million years. These changes are much larger than the ones driven by solar irradiance and volcanic activity.</p>
<p>About 6000 years ago, during the <em>Mid-Holocene Warm Period</em>, a summer maximum insolation for the northern hemisphere was reached (<a href="#fig-stoa_hovmoeller_holo" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>). During this period, temperatures and solar irradiance during the growing season were elevated relative to the pre-industrial period and precipitation patterns shifted. This had profound effects on vegetation and the carbon cycle. Testimony to this change are reconstructions that document a “Green Sahara” and a northward shift temperate and boreal forest biomes <span class="citation" data-cites="macdonald00qr prentice00biome">(<a href="references.html#ref-macdonald00qr" role="doc-biblioref">MacDonald et al. 2000</a>; <a href="references.html#ref-prentice00biome" role="doc-biblioref">Prentice, Jolly, and Participants 2000</a>)</span> during this period.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test:</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp &lt;- purrr::map(seq(from = -300000, to = 2000, by = 500),</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                   ~calc_daily_solar(65, 173, year = .)) |&gt; </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   purrr::map_dbl("ra_j.m2")</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># all combinations of day-of-year and latitude</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>df_holo <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">doy =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">365</span>, <span class="at">by =</span> <span class="dv">2</span>), </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lat =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="dv">90</span>, <span class="at">by =</span> <span class="dv">2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s_toa_holo =</span> <span class="fu">calc_daily_solar</span>(lat, doy, <span class="at">year =</span> <span class="sc">-</span><span class="dv">4000</span>)<span class="sc">$</span>ra_j.m2) <span class="sc">|&gt;</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"doy"</span>, <span class="st">"lat"</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> (s_toa_holo <span class="sc">-</span> s_toa))</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>df_holo <span class="sc">|&gt;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> doy,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> lat,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> diff)) <span class="sc">+</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  khroma<span class="sc">::</span><span class="fu">scale_fill_roma</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">173</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Mid-Holocene top-of-atmosphere solar radiation anomaly"</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Daily total, "</span>, <span class="fu">italic</span>(I)[TOA], <span class="st">"(6 kyr BP) - "</span>, <span class="fu">italic</span>(I)[TOA], <span class="st">"(present)"</span> )),</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Day of year"</span>,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Latitude (°N)"</span>,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"J m"</span><span class="sc">^-</span><span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-stoa_hovmoeller_holo" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stoa_hovmoeller_holo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-stoa_hovmoeller_holo-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stoa_hovmoeller_holo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6: Mid-Holocene solar radiation anomaly, calculated as the difference in the daily total top-of-atmosphere solar radiation at 6 kyr BP minus present-day (year 2000).
</figcaption>
</figure>
</div>
</div>
</div>
<!-- XXX exercise for LES II: -->
<!-- - Simulate land C balance changes in response to a harmonic oscillation of the solar constant -->
<!-- XXX to add: -->
<!-- - Orbital parameters and long-term radiation change -->
<!-- - Calculate orbital parameters using ORBPAR.SUB from https://data.giss.nasa.gov/modelE/ar5plots/srorbpar.html -->
</section>
</section>
<section id="sec-light-absorption" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="sec-light-absorption"><span class="header-section-number">4.1.3</span> Canopy light absorption</h3>
<p>The fraction of absorbed photosynthetically active radiation (fAPAR) increases with the projected (one-sided) surface area of leaves per unit ground area (the <em>leaf area index</em>, LAI). Note that the total surface area of leaves is roughly twice the projected surface area. The LAI is an ecosystem-level variable and reflects the leaf area density of the whole canopy which may be composed of multiple species and organised in multiple canopy layers. While temperate and boreal forests may form a single understorey and attain LAI values of 4-6 m<sup>2</sup> m<sup>-1</sup>, tropical moist forests may have multiple canopy layers and an LAI of over 6 m<sup>2</sup> m<sup>-1</sup> (<a href="biogeography.html#fig-lai" class="quarto-xref">Figure&nbsp;<span>2.15</span></a>).</p>
<p>While the intensity of shortwave (solar) radiation is highest at the top of the canopy, it is progressively attenuated as it penetrates into the canopy. Radiation gets reflected, absorbed and transmitted by individual leaves. Each of these processes affects light differently in different wavelengths, depends on the solar zenith angle, on the three-dimensional arrangement of leaves in the canopy (angles, “clumping”), and on the pigments on the leaf surfaces that are responsible for light absorption. Pigments change across species and may vary in response to stress (e.g., by frost, heat, or water limitation).</p>
<p>In brief, canopy <em>radiative transfer</em> is complex. A simple model of radiation extinction is given by the <em>Beer-Lambert law</em>. To apply it for radiative transfer in the canopy, we assume that a leaf only <em>absorbs</em> light, but does not reflect or transmit it. Following this model, the light extinction at canopy depth <span class="math inline">\(z\)</span> (measuring from the top) is proportional to the light intensity at that depth and an “optical density” <span class="math inline">\(\mu\)</span>. <span class="math display">\[
\frac{\mathrm{d}I}{\mathrm{d}z} = -\mu\;I(z)
\]</span> We further assume that the canopy is a homogenous turbid medium. In other words, we assume that leaves are uniformly distributed across the canopy and that the optical density is given by the leaf area index <span class="math inline">\(L\)</span> divided by the total canopy depth <span class="math inline">\(z_0\)</span>: <span class="math display">\[
\mu = k \frac{L}{z_0}
\]</span> <span class="math inline">\(k\)</span> is the leaf area-specific optical density, or <em>light extinction coefficient</em>. Therefore, the radiation intensity at the bottom of the canopy (<span class="math inline">\(z_0\)</span>) is: <span class="math display">\[
I(z_0) = I_0 \; e^{-kL}\;,
\]</span> and the fraction of absorbed (photosynthetically active) radiation is <span class="math display">\[
\mathrm{fAPAR} = 1 - e^{-kL}\;.
\]</span> A typical value of the light extinction coefficient <span class="math inline">\(k\)</span> in the visible (photosynthetically active) wavelength spectrum is 0.5.</p>
<p>The radiation <span class="math inline">\(I\)</span> consists of <em>direct</em> radiation from the sun and <em>diffuse</em> radiation from the sky and from radiation scattered within the canopy. This distinction is relevant for understanding radiation absorption by the canopy and canopy-level photosynthesis. Two important implications are the following. First, diffuse radiation is more effectively absorbed by canopies, particularly at low LAI. The reduction of GPP under cloudy conditions is therefore less than what would be expected from considering only changes in <span class="math inline">\(I_0\)</span> (the effective <span class="math inline">\(k\)</span> is higher for diffuse radiation than for direct radiation).</p>
<p>Second, the energy flux of direct radiation is much higher than that of diffuse radiation. Although at greater canopy depths, leaves are more frequently exposed to diffuse than to direct radiation, the latter provides potentially valuable energy for photosynthesis, but occurs very rarely (<em>sunflecks</em>). Leaves have to balance the rare high-intensity light levels and the frequent low-intensity levels for adjusting photosynthetic capacities.</p>
<!-- XXX to add: -->
<!-- - box for Mercado et al. paper on volcanic eruption and the land C sink -->
</section>
<section id="light-use-efficiency-and-photosynthesis" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="light-use-efficiency-and-photosynthesis"><span class="header-section-number">4.1.4</span> Light use efficiency and photosynthesis</h3>
<p>The effiency at which absorbed photons (radiation) are converted into C in the form of sugars depends on the conductance to CO<sub>2</sub> uptake by the leaf and on the activity of the photosynthetic machinery. CO<sub>2</sub> uptake by the leaf happens by diffusion through pores at the leaf surface (<em>stomata</em>, <a href="#fig-stomata" class="quarto-xref">Figure&nbsp;<span>4.7</span></a>). The opening of stomata is dynamically regulated in response to environmental conditions (light, CO<sub>2</sub>, temperature, atmospheric humidity) and controls the conductance to CO<sub>2</sub> diffusion. The CO<sub>2</sub> uptake flux by diffusive transport through stomata can thus be described by <em>Fick’s law</em> which states that the flux is proportional to the concentration difference of CO<sub>2</sub> inside and outside the leaf. <span id="eq-photo-fick"><span class="math display">\[
A = g_s(c_a - c_i)
\tag{4.6}\]</span></span> <span class="math inline">\(c_a\)</span> is the ambient CO<sub>2</sub> concentration (outside the leaf), and <span class="math inline">\(c_i\)</span> is the CO<sub>2</sub> concentration at the chloroplast. <span class="math inline">\(g_s\)</span> is the stomatal conductance. Note that we use the variable name <span class="math inline">\(A\)</span> here for CO<sub>2</sub> assimilation by photosynthesis. In constrast to the ecosystem-level variable GPP, <span class="math inline">\(A\)</span> refers to the leaf-level flux.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-stomata" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stomata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/stomata.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stomata-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7: CO<sub>2</sub> diffuses into the leaf through stomata, while water vapour diffuses out of the leaf. The water vapour diffusion out of the leaves (transpiration) is introduced in <a href="landclimate.html" class="quarto-xref"><span>Chapter 7</span></a>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Photosynthetic CO<sub>2</sub> assimilation leads to a continous depletion of CO<sub>2</sub> inside the leaf. Therefore, <span class="math inline">\(c_i\)</span> reflects photosynthetic rates. This description of <span class="math inline">\(A\)</span> is specific for plants that follow the C<sub>3</sub> photosynthetic pathway - the majority of plants and all trees. Grasses growing in warm climates predominantly follow the C<sub>4</sub> photosynthetic pathway (see <a href="#sec-c4" class="quarto-xref"><span>Section 4.1.7</span></a>).</p>
<p>Modelling photosynthesis is relatively complex because <span class="math inline">\(g_s\)</span> depends on <span class="math inline">\(A\)</span>. <a href="#eq-photo-fick" class="quarto-xref">Equation&nbsp;<span>4.6</span></a> can therefore not be solved in a straight-forward manner. Furthermore, plants coordinate stomatal conductance to balance water losses and C assimilation but the exact relationship varies between species and depends on a multitude of mechanisms and traits related water transport in the plant (<a href="#sec-stomatal-regulation" class="quarto-xref"><span>Section 4.1.6</span></a>). Here, let’s start by taking <span class="math inline">\(g_s\)</span> as given and look at how the assimilation rate <span class="math inline">\(A\)</span> depends on <span class="math inline">\(c_i\)</span>.</p>
<p>The primary processes are happening in the chloroplasts which are located in the mesophyll cells of leaves. After diffusing across stomata, CO<sub>2</sub> diffuses across the mesophyll cell to the chloroplast. The conductance to this diffusion step - mesophyll conductance - is often ignored for modelling photosynthesis. Reflecting this, we are referring to “leaf-internal CO<sub>2</sub> concentration, <span class="math inline">\(c_i\)</span>” here, instead of a more correct CO<sub>2</sub> concentration at the chloroplast.</p>
<p>Before returning to a mathematical description of photosynthesis, let’s step back and look at the process of leaf-level photosyntheis. Three steps of the photosynthetic apparatus can be distinguished (based on <span class="citation" data-cites="lambers08">Lambers, Chapin, and Pons (<a href="references.html#ref-lambers08" role="doc-biblioref">2008</a>)</span> and <span class="citation" data-cites="bonan">Bonan (<a href="references.html#ref-bonan" role="doc-biblioref">2015</a>)</span>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-photosynthesis" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-photosynthesis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/photosynthesis.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-photosynthesis-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.8: Overview of photosynthesis, distinguishing the light reactions and the Calvin cycle. Image taken <a href="https://bookdown.org/jcog196013/BS2003/photosynthesis.html">https://bookdown.org/jcog196013/BS2003/photosynthesis.html</a>.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="light-absorption-at-the-cellular-level" class="level4" data-number="4.1.4.1">
<h4 data-number="4.1.4.1" class="anchored" data-anchor-id="light-absorption-at-the-cellular-level"><span class="header-section-number">4.1.4.1</span> Light absorption at the cellular level</h4>
<p>Light (photons) in the photosynthetically active wavelength spectrum (400-700 nm) is absorbed by <em>pigments</em> - mainly chlorophyll. The absorbed energy is transported in the form of excited chlorophyll to the reaction centers of photosystem I (PSI) and photosystem II (PSII). Relevant for photosynthesis is the number of photons in the photosynthetically active spectrum, not their total energy. That’s why <a href="#eq-ppfd" class="quarto-xref">Equation&nbsp;<span>4.2</span></a> is expressed in units of photons, not energy (Watts). A photon in the blue wavelength has the same effect on CO<sub>2</sub> assimilation as a photon in the red wavelength. The excess energy is dissipated as heat or through other pathways.</p>
</section>
<section id="light-reactions" class="level4" data-number="4.1.4.2">
<h4 data-number="4.1.4.2" class="anchored" data-anchor-id="light-reactions"><span class="header-section-number">4.1.4.2</span> Light reactions</h4>
<p>In the reaction centers, the excitation energy is used for splitting electrons from water molecules, producing oxygen (O<sub>2</sub>) as a “side-product”. The electrons are transported along the electron transport chain and are used to produce NADPH and ATP. These are called the <em>light reactions</em> of photosynthesis. Up to here, radiation energy has been converted into chemical energy in the form of ATP. The production of ATP consumes inorganic phosphate.</p>
</section>
<section id="calvin-cycle" class="level4" data-number="4.1.4.3">
<h4 data-number="4.1.4.3" class="anchored" data-anchor-id="calvin-cycle"><span class="header-section-number">4.1.4.3</span> Calvin cycle</h4>
<p>NADPH and ATP are then used for reducing CO<sub>2</sub> (the energy-demanding reversal of oxidation) in the <em>Calvin cycle</em>. This step forms C<sub>3</sub> compounds (triose-phosphates) and occurs independently of light. It is therefore commonly referred to as the “dark reactions” of photosynthesis. Rubisco (ribulose-1,5-bisphosphate carboxylase/oxygenase) is the principal enzyme involved in the Calvin cycle and the amount of Rubisco determines the capacity for the carboxylation of RuBP (Ribulose-1,5-bisphosphate). Rubisco also catalyzes the oxygenation of RuBP which consumes O<sub>2</sub> and produces CO<sub>2</sub> as part of <em>photorespiration</em>. This respiration scales with photosynthetic activity and reduces the net photosynthetic CO<sub>2</sub> by 30-50%, depending on the relative concentrations of CO<sub>2</sub> and O<sub>2</sub>. At very low CO<sub>2</sub> levels, around 30-50 ppm, the <em>photorespiratory compensation point</em> is reached and net photosynthesis is zero. In contrast to photorespiration, <em>dark respiration</em> (<span class="math inline">\(R_d\)</span>), which also produces CO<sub>2</sub>, arises from the decarboxylation of Rubisco and is independent of light, but proportional to the amount of Rubisco.</p>
<p>Reduced C in the form of sucrose or (after an additional step) starch is either consumed in the leaf during the night, or exported through the phloem and used for synthesising biomass or supplying plant-internal C storage as <em>non-structural C</em>.</p>
</section>
<section id="summary" class="level4" data-number="4.1.4.4">
<h4 data-number="4.1.4.4" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.1.4.4</span> Summary</h4>
<p>The chemical summary equation of photosynthesis is: <span id="eq-photosynthesis-chemical"><span class="math display">\[
n\mathrm{CO}_2 + 2n\mathrm{H}_2\mathrm{O} \rightarrow (\mathrm{CH}_2\mathrm{O})_n + n\mathrm{O}_2 + n\mathrm{H}_2\mathrm{O}
\tag{4.7}\]</span></span> A total of eight photons is consumed to assimilate one molecule of CO<sub>2</sub>. For each molecule of CO<sub>2</sub>, one molecule of O<sub>2</sub> is produced. And for each molecule of CO<sub>2</sub>, one molecule of H<sub>2</sub>O is consumed (net). Note however, that this water consumption is not the primary reason for why plants use water. A much larger amount of water is consumed by the diffusion of water vapour from the water-saturated air inside the leaves out of the stomata. This <em>transpiration</em> flux is further explained in <a href="landclimate.html" class="quarto-xref"><span>Chapter 7</span></a>.</p>
</section>
<section id="response-to-light-and-co2" class="level4" data-number="4.1.4.5">
<h4 data-number="4.1.4.5" class="anchored" data-anchor-id="response-to-light-and-co2"><span class="header-section-number">4.1.4.5</span> Response to light and CO<sub>2</sub></h4>
<p>The three steps described above operate in series and each step is potentially rate-limiting and responds differently to the environment. The rates are coordinated such that they are roughly co-limiting for average environmental conditions to which a leaf is exposed during a day. An imbalance of rates can lead to an excess production of electrons and can cause damage to the photosynthetic apparatus. This happens for example when leaves are exposed to very cold temperatures and high light during a frost event, or when you move your indoor plant that has been sitting in a dark corner for years suddenly into full sunlight outdoors.</p>
<p>The response of photosynthetic CO<sub>2</sub> assimilation (<span class="math inline">\(A\)</span>) to light (PPFD) and leaf-internal CO<sub>2</sub> (<span class="math inline">\(c_i\)</span>) reflects the serial nature of how the light and dark reactions are connected. <span class="math inline">\(A\)</span> saturates both in response to increasing PPFD as well as to increasing <span class="math inline">\(c_i\)</span>. When a leaf is exposed to increasing PPFD, <span class="math inline">\(A\)</span> initially increases and eventually saturates (<a href="#fig-photosynthesis_light" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>). The slope of the initial linear increase reflects the efficiency at which photons are used for CO<sub>2</sub> assimilation (the <em>quantum yield</em> <span class="math inline">\(\varphi_0\)</span>). Under these conditions, light, i.e.&nbsp;the rate of the light reactions, are limiting, not CO<sub>2</sub>. Under conditions of very high light, the dark reactions of the Calvin cycle become limiting. The assimilation rate attained under saturating light is commonly referred to as <span class="math inline">\(A_\mathrm{max}\)</span>.</p>
<p>The level at which the light response of <span class="math inline">\(A\)</span> saturates varies within a species and across different species. Variations within species arise through the <em>acclimation</em> of the light reaction capacities to the typical light intensities to which a leaf is exposed. Acclimation evolves over time scales of weeks to months (Thus, your indoor plant suffers because the change to high-light conditions happened to fast.). <span class="math inline">\(A_\mathrm{max}\)</span> also varies across species, reflecting the <em>adaptation</em> through evolution of different species to the environment in which they commonly grow. Typical difference in light adaptation are evident between plants that grow in the shady understorey versus plants that grow in the sun-exposed upper canopy.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-photosynthesis_light" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-photosynthesis_light-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/assim_response_to_light_lambers08.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-photosynthesis_light-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.9: Response of leaf photosynthesis to light and how it varies within species through acclimation to different growth environments (A) and across species through evolutionary adaptation (B). Figure from <span class="citation" data-cites="lambers08">Lambers, Chapin, and Pons (<a href="references.html#ref-lambers08" role="doc-biblioref">2008</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In a similar fashion, the response of <span class="math inline">\(A\)</span> to <span class="math inline">\(c_i\)</span> initially increase and saturates at high <span class="math inline">\(c_i\)</span>. This is reflected by the so-called “<em>A</em>-<em>c</em><sub>i</sub> curve”. Commonly, net assimilation <span class="math inline">\(A_n=A-R_d\)</span> is considered. <span class="math inline">\(A_n\)</span> is initially negative until the photorespiratory compensation point (<span class="math inline">\(\Gamma^\ast\)</span>) is reached. Then, <span class="math inline">\(A_n\)</span> increases steeply with <span class="math inline">\(c_i\)</span> as it is limited by the rate of RuBP carboxylation by Rubisco (<span class="math inline">\(V_\mathrm{cmax}\)</span>). This functional response of assimilation is commonly denoted <span class="math inline">\(A_C\)</span>. As <span class="math inline">\(c_i\)</span> increases further, <span class="math inline">\(A\)</span> is no longer limited by RuBP carboxylation, but by the rate at which RuBP becomes available. This, in turn, is governed by the rate at which ATP and NADPH are produced and thus by the rate of electron transport <span class="math inline">\(J\)</span>. This functional response of assimilation is commonly denoted <span class="math inline">\(A_J\)</span>. A limiting electron transport rate may be due to limiting light or a limiting capacity of electron transport (<span class="math inline">\(J_\mathrm{max}\)</span>). A slower further increase of <span class="math inline">\(A\)</span> with <span class="math inline">\(c_i\)</span> in the electron transport-limited range is due to the suppression of RuBP oxygenation at high concentrations of CO<sub>2</sub> (relative to O<sub>2</sub>). The effective assimilation rate across the full range of <span class="math inline">\(c_i\)</span> is the minimum of the electron transport-limited and the RuBP carboxylation-limited rate: <span class="math display">\[
A_n = \min(A_C, A_J) - R_d
\]</span></p>
<p>The <em>A</em>-<em>c</em><sub>i</sub> curve (<a href="#fig-a-ci-curve" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>) can be measured in the field and reveals multiple quantities (<span class="math inline">\(V_\mathrm{cmax}\)</span>, <span class="math inline">\(J_\mathrm{max}\)</span>, <span class="math inline">\(\Gamma^\ast\)</span>, and the “shape parameters” of <span class="math inline">\(A_C\)</span> and <span class="math inline">\(A_J\)</span>). These quantities are key for quantitatively describing and modeling leaf photosynthesis. The acclimation and adaptation of <span class="math inline">\(A_\mathrm{max}\)</span> (<a href="#fig-photosynthesis_light" class="quarto-xref">Figure&nbsp;<span>4.9</span></a>) reflects an acclimation and adaptation of the electron transport capacity and the capacity for RuBP carboxylation. Although acclimation can occur, it is not fast enough to respond to the strongly varying light conditions during a day. Therefore, plants have to tune the capacities of the different photosynthetic reactions such that they are mostly near the co-limitation point.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-a-ci-curve" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-ci-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/a_ci_curve.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-ci-curve-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.10: The <em>A</em>-<em>c</em><sub>i</sub> curve. Net assimilation (<em>A</em><sub>n</sub> = <em>A</em> - <em>R</em><sub>d</sub>) is measured for different levels of leaf-internal CO<sub>2</sub> concentrations (black dots). The functional forms of <em>A</em><sub>C</sub> and <em>A</em><sub>J</sub> are fitted to the data points. The grey point indicates the co-limitation point. Figure from <span class="citation" data-cites="duursma15plosone">Duursma (<a href="references.html#ref-duursma15plosone" role="doc-biblioref">2015</a>)</span>.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="farquhar-von-caemmerer-berry-model" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="farquhar-von-caemmerer-berry-model"><span class="header-section-number">4.1.5</span> Farquhar-von Caemmerer-Berry model</h3>
<p>Following the Farquhar-von Caemmerer-Berry (FvCB) model for C<sub>3</sub> photosynthesis <span class="citation" data-cites="farquhar80">(<a href="references.html#ref-farquhar80" role="doc-biblioref">Farquhar, Caemmerer, and Berry 1980</a>)</span>, the RuBP carboxylation-limited assimilation rate <span class="math inline">\(A_C\)</span> can be described as <span id="eq-ac"><span class="math display">\[
A_C = V_\mathrm{cmax} \frac{c_i - \Gamma^\ast}{c_i + K} \;,
\tag{4.8}\]</span></span> where <span class="math inline">\(K\)</span> is the effective Michaelis-Menten coefficient for <span class="math inline">\(A_C\)</span>. It depends, i.a., on the partial pressure of oxygen.</p>
<p>The electron transport-limited assimilation rate <span class="math inline">\(A_J\)</span> can be described as <span id="eq-aj"><span class="math display">\[
A_J = \frac{J}{4} \cdot \frac{c_i - \Gamma^\ast}{c_i + 2 \Gamma^\ast}
\tag{4.9}\]</span></span> The electron transport rate <span class="math inline">\(J\)</span> is described by a saturating function that increases with absorbed light <span class="math inline">\(I_\mathrm{abs}\)</span> up to a maximum rate <span class="math inline">\(J_\mathrm{max}\)</span> <span id="eq-jmaxlim"><span class="math display">\[
J = \frac{4\varphi_0 I_\mathrm{abs}}{\sqrt{1+\left(\frac{4\varphi_0 I_\mathrm{abs}}{J_\mathrm{max}}\right)^2}}
\tag{4.10}\]</span></span> Note that the “photosynthesis parameters” <span class="math inline">\(V_\mathrm{cmax}\)</span>, <span class="math inline">\(J_\mathrm{max}\)</span>, <span class="math inline">\(\Gamma^\ast\)</span>, and <span class="math inline">\(K\)</span> have a strong temperature dependency. The latter two also depend on the partial pressure of O<sub>2</sub> and therefore on the atmospheric pressure. These dependencies are described in <span class="citation" data-cites="stocker20gmd">Stocker et al. (<a href="references.html#ref-stocker20gmd" role="doc-biblioref">2020</a>)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpmodel)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># modified seq() function to get a logarithmically spaced sequence</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>lseq <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">from=</span><span class="dv">1</span>, <span class="at">to=</span><span class="dv">100000</span>, <span class="at">length.out=</span><span class="dv">6</span>) {</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="fu">seq</span>(<span class="fu">log</span>(from), <span class="fu">log</span>(to), <span class="at">length.out =</span> length.out))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set model parameters (constants)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># see Stocker et al., 2020 GMD for a description</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">146</span>          <span class="co"># unit cost ratio a/b</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>c_cost <span class="ot">&lt;-</span> <span class="fl">0.41</span>       <span class="co"># marginal cost of Jmax</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fl">0.105</span>       <span class="co"># unit cost ratio c/b</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>kphio <span class="ot">&lt;-</span> <span class="fl">0.085</span>       <span class="co"># quantum yield efficiency</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>c_molmass <span class="ot">&lt;-</span> <span class="fl">12.0107</span> <span class="co"># molar mass, g / mol</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Define environmental conditions</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>tc <span class="ot">&lt;-</span> <span class="dv">15</span>             <span class="co"># temperature, deg C</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>ppfd <span class="ot">&lt;-</span> <span class="dv">500</span>          <span class="co"># micro-mol/m2/s</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>vpd  <span class="ot">&lt;-</span> <span class="dv">300</span>          <span class="co"># Pa</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>co2  <span class="ot">&lt;-</span> <span class="dv">400</span>          <span class="co"># ppm</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>elv  <span class="ot">&lt;-</span> <span class="dv">0</span>            <span class="co"># m.a.s.l.</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>fapar <span class="ot">&lt;-</span> <span class="dv">1</span>           <span class="co"># fraction</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>patm <span class="ot">&lt;-</span> <span class="dv">101325</span>       <span class="co"># Pa</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># get photosynthesis parameters gammastar, vcmax, jmax from p-model</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co"># this assumes vcmax and jmax to be optimally acclimated/adapted to</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># the specified environmental conditions and considers the temperature</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># and atmospheric-pressure dependence of all parameters.</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>out_pmodel <span class="ot">&lt;-</span> <span class="fu">rpmodel</span>(</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">tc             =</span> tc,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">vpd            =</span> vpd,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">co2            =</span> co2,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">elv            =</span> elv,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">kphio          =</span> kphio,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">beta           =</span> beta,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">fapar          =</span> fapar,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">ppfd           =</span> ppfd,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">method_optci   =</span> <span class="st">"prentice14"</span>,</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">method_jmaxlim =</span> <span class="st">"wang17"</span>,</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">do_ftemp_kphio =</span> <span class="cn">FALSE</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># electron transport-limited assimilation rate as a function of CO2 partial pressure</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>calc_aj <span class="ot">&lt;-</span> <span class="cf">function</span>(ci, gammastar, kphio, ppfd, jmax){</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  kphio <span class="sc">*</span> ppfd <span class="sc">*</span> (ci <span class="sc">-</span> gammastar)<span class="sc">/</span>(ci <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> gammastar) <span class="sc">*</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">1</span><span class="sc">+</span>((<span class="dv">4</span> <span class="sc">*</span> kphio <span class="sc">*</span> ppfd)<span class="sc">/</span>jmax)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="co"># RuBP carboxylation-limited assimilation rate as a function of CO2 partial pressure</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>calc_ac <span class="ot">&lt;-</span> <span class="cf">function</span>(ci, gammastar, kmm, vcmax){</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  vcmax <span class="sc">*</span> (ci <span class="sc">-</span> gammastar)<span class="sc">/</span>(ci <span class="sc">+</span> kmm)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a><span class="co"># assimilation rate given stomatal conductance and leaf-internal </span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># CO2 partial pressure</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>calc_a_gs <span class="ot">&lt;-</span> <span class="cf">function</span>(ci, gs, ca){</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  gs <span class="sc">*</span> (ca <span class="sc">-</span> ci)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="co"># conversion of CO2 concentration in ppm to partial pressure in Pa</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>co2_to_ca <span class="ot">&lt;-</span> <span class="cf">function</span>( co2, patm ){</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  ( <span class="fl">1.0e-6</span> ) <span class="sc">*</span> co2 <span class="sc">*</span> patm</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>df_ci <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">ci =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ci_pa =</span> <span class="fu">co2_to_ca</span>(ci, <span class="at">patm =</span> patm)) <span class="sc">|&gt;</span> </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_j =</span> <span class="fu">calc_aj</span>(ci_pa, </span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                       out_pmodel<span class="sc">$</span>gammastar, </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                       <span class="at">kphio =</span> kphio, </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ppfd =</span> ppfd, </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>                       <span class="at">jmax =</span> out_pmodel<span class="sc">$</span>jmax)) <span class="sc">|&gt;</span> </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_c =</span> <span class="fu">calc_ac</span>(ci_pa, </span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                       out_pmodel<span class="sc">$</span>gammastar, </span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                       out_pmodel<span class="sc">$</span>kmm, </span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>                       <span class="at">vcmax =</span> out_pmodel<span class="sc">$</span>vcmax)) <span class="sc">|&gt;</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_act =</span> <span class="fu">min</span>(a_j, a_c)) <span class="sc">|&gt;</span> </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_gs =</span> <span class="fu">calc_a_gs</span>(ci_pa, <span class="at">gs =</span> out_pmodel<span class="sc">$</span>gs, <span class="at">ca =</span> out_pmodel<span class="sc">$</span>ca))</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>df_ci <span class="sc">|&gt;</span> </span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(a_j, a_c, a_gs), <span class="at">names_to =</span> <span class="st">"Rate"</span>, <span class="at">values_to =</span> <span class="st">"a_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pivot_longer(cols = c(a_j, a_c), names_to = "Rate", values_to = "a_") |&gt; </span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ci)) <span class="sc">+</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> a_, <span class="at">color =</span> Rate)) <span class="sc">+</span></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> a_act)) <span class="sc">+</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(aes(y = a_gs), linetype = "dashed") +</span></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">00</span>, <span class="dv">1000</span>) <span class="sc">+</span> </span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"c"</span>[i], <span class="st">" (ppm)"</span>)), </span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"A ("</span>, mu, <span class="st">"mol m"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>},<span class="st">" s"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"a_gs"</span>,</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>               <span class="st">"a_j"</span>,</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>               <span class="st">"a_c"</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)[gs])),</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)[J])),</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)[C]))),</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>( <span class="st">"#009E73"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#E69F00"</span>)) <span class="sc">+</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-a-ci-curve-rpmodel" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-a-ci-curve-rpmodel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-a-ci-curve-rpmodel-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-a-ci-curve-rpmodel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.11: The <em>A</em>-<em>c</em><sub>i</sub> curve.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="response-to-temperature" class="level4" data-number="4.1.5.1">
<h4 data-number="4.1.5.1" class="anchored" data-anchor-id="response-to-temperature"><span class="header-section-number">4.1.5.1</span> Response to temperature</h4>
<p>All parameters fitted by the <em>A</em>-<em>c</em><sub>i</sub> curve (<a href="#fig-a-ci-curve" class="quarto-xref">Figure&nbsp;<span>4.10</span></a>) have a temperature dependency.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df_temp <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">temp =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gammastar =</span> <span class="fu">gammastar</span>(temp, <span class="at">patm =</span> <span class="dv">101325</span>),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">kmm =</span> <span class="fu">kmm</span>(temp, <span class="at">patm =</span> <span class="dv">101325</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">vcmax =</span> out_pmodel<span class="sc">$</span>vcmax25 <span class="sc">*</span> <span class="fu">ftemp_inst_vcmax</span>(temp, <span class="at">tcgrowth =</span> <span class="dv">15</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">jmax =</span> <span class="fl">1.7</span> <span class="sc">*</span> out_pmodel<span class="sc">$</span>vcmax25 <span class="sc">*</span> <span class="fu">ftemp_inst_jmax</span>(temp, <span class="at">tcgrowth =</span> <span class="dv">15</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rd =</span> <span class="fl">0.05</span> <span class="sc">*</span> out_pmodel<span class="sc">$</span>vcmax25 <span class="sc">*</span> <span class="fu">ftemp_inst_rd</span>(temp)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_j =</span> <span class="fu">calc_aj</span>(<span class="fl">28.14209</span>, gammastar, <span class="at">kphio =</span> kphio, <span class="at">ppfd =</span> ppfd, <span class="at">jmax =</span> jmax) <span class="sc">-</span> rd) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_c =</span> <span class="fu">calc_ac</span>(<span class="fl">28.14209</span>, gammastar, kmm, <span class="at">vcmax =</span> vcmax) <span class="sc">-</span> rd) <span class="sc">|&gt;</span> </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">assim =</span> <span class="fu">min</span>(a_j, a_c))</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>gg1 <span class="ot">&lt;-</span> df_temp <span class="sc">|&gt;</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(gammastar, kmm), </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Rate"</span>, </span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> Rate)) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Temperature (°C)"</span>)), </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Value (Pa)"</span>))) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  khroma<span class="sc">::</span><span class="fu">scale_color_okabeito</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>, </span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"gammastar"</span>, </span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>               <span class="st">"kmm"</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(Gamma)<span class="sc">^</span><span class="st">"*"</span>)), </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">italic</span>(K)))</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>gg2 <span class="ot">&lt;-</span> df_temp <span class="sc">|&gt;</span> </span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(vcmax, jmax, rd), </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Rate"</span>, </span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> Rate)) <span class="sc">+</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Temperature (°C)"</span>)), </span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Rate ("</span>, mu, <span class="st">"mol m"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>},<span class="st">" s"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  khroma<span class="sc">::</span><span class="fu">scale_color_okabeito</span>(</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>, </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"vcmax"</span>, </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>               <span class="st">"jmax"</span>, </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>               <span class="st">"rd"</span>),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"V"</span>)[cmax])), </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"J"</span>)[max])), </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"R"</span>)[d])))</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>gg3 <span class="ot">&lt;-</span> df_temp <span class="sc">|&gt;</span> </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(assim, a_c, a_j), </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Rate"</span>, </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> Rate)) <span class="sc">+</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="st">"Temperature (°C)"</span>)), </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>), <span class="st">"("</span>, mu, <span class="st">"mol m"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">2</span>},<span class="st">" s"</span> <span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}, <span class="st">")"</span>))) <span class="sc">+</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">""</span>,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"a_c"</span>,</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>               <span class="st">"a_j"</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>               <span class="st">"assim"</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)[C])),</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)[J])),</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>               <span class="fu">expression</span>(<span class="fu">paste</span>(<span class="fu">italic</span>(<span class="st">"A"</span>)))),</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"black"</span>)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(gg1, gg2, gg3, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-temp_dep" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-temp_dep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="carboncycle_2_files/figure-html/fig-temp_dep-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-temp_dep-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.12: Temperature dependencies of parameters in the FvCB model.
</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li>C4 photosynthesis</li>
</ul>
</section>
</section>
<section id="sec-stomatal-regulation" class="level3" data-number="4.1.6">
<h3 data-number="4.1.6" class="anchored" data-anchor-id="sec-stomatal-regulation"><span class="header-section-number">4.1.6</span> Stomatal regulation</h3>
</section>
<section id="sec-c4" class="level3" data-number="4.1.7">
<h3 data-number="4.1.7" class="anchored" data-anchor-id="sec-c4"><span class="header-section-number">4.1.7</span> C<sub>4</sub> photosynthesis</h3>
</section>
<section id="isotopic-fractionation" class="level3" data-number="4.1.8">
<h3 data-number="4.1.8" class="anchored" data-anchor-id="isotopic-fractionation"><span class="header-section-number">4.1.8</span> Isotopic fractionation</h3>
<ul>
<li>13C fractionation, Keeling et al., 2017</li>
</ul>
<p>Box: - FLUXNET data, global upscaling of fluxes</p>
</section>
</section>
<section id="sec-carboncycle_ecosystem" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-carboncycle_ecosystem"><span class="header-section-number">4.2</span> Ecosystem C dynamics</h2>
<ul>
<li>Land: GPP-NPP, vegC, soilC, Ra, Rh</li>
<li>The carbon cascade {#sec-cascade }</li>
<li>The C cascade: Tree growth, allocation, mortality, forest dynamics</li>
<li>multi-box model</li>
</ul>
<section id="sec-npp" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="sec-npp"><span class="header-section-number">4.2.1</span> Net primary productivity</h3>
<ul>
<li>carbon use efficiency and its relative constancy</li>
<li>biomass productivity</li>
</ul>
</section>
<section id="allocation" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="allocation"><span class="header-section-number">4.2.2</span> Allocation</h3>
</section>
<section id="turnover" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="turnover"><span class="header-section-number">4.2.3</span> Turnover</h3>
</section>
<section id="the-c-cascade" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="the-c-cascade"><span class="header-section-number">4.2.4</span> The C cascade</h3>
<p>Very Simple Ecosystem Model</p>
</section>
</section>
<section id="sec-global-patterns" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-global-patterns"><span class="header-section-number">4.3</span> Spatial and temporal patterns of the global C cycle</h2>
<section id="global-patterns-in-gpp" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="global-patterns-in-gpp"><span class="header-section-number">4.3.1</span> Global patterns in GPP</h3>
<ul>
<li>Controls on terrestrial and ecosystem primary production Wang et al., 2014 doi:10.5194/bg-11-5987-2014</li>
</ul>
</section>
<section id="seasonal-cycle" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="seasonal-cycle"><span class="header-section-number">4.3.2</span> Seasonal cycle</h3>
<ul>
<li>Seasonality Bonan 18.3
<ul>
<li>NDVI over the seasons</li>
<li>phenology</li>
<li>cold-hardening</li>
</ul></li>
<li>Show mean seasonality of biome-representative flux sites of:
<ul>
<li>Rn</li>
<li>ET</li>
<li>LAI</li>
<li>GPP</li>
<li>NEE</li>
</ul></li>
<li>Demonstrate how the LUE model (assuming const. LUE) explains a large part of variations in GPP, and the VSEM a large part of NEE</li>
</ul>
</section>
<section id="diurnal-cycle" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="diurnal-cycle"><span class="header-section-number">4.3.3</span> Diurnal cycle</h3>
<ul>
<li>Demonstrate how (where) the constant LUE fails to explain the diurnal cycle</li>
</ul>
</section>
<section id="breathing-of-the-earth" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="breathing-of-the-earth"><span class="header-section-number">4.3.4</span> Breathing of the Earth</h3>
</section>
<section id="global-patterns-in-soil-and-vegetation-c" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="global-patterns-in-soil-and-vegetation-c"><span class="header-section-number">4.3.5</span> Global patterns in soil and vegetation C</h3>
<ul>
<li>Global (latitudinal) distribution of vegetation and soil carbon stocks</li>
<li>Model for GPP-driven C stocks, considering temperature-dependence of heterotrophic respiration (Q10); respiration inhibition under anaerobic conditions (peatlands)</li>
</ul>
</section>
<section id="peatlands" class="level3" data-number="4.3.6">
<h3 data-number="4.3.6" class="anchored" data-anchor-id="peatlands"><span class="header-section-number">4.3.6</span> Peatlands</h3>
</section>
<section id="permafrost" class="level3" data-number="4.3.7">
<h3 data-number="4.3.7" class="anchored" data-anchor-id="permafrost"><span class="header-section-number">4.3.7</span> Permafrost</h3>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bonan" class="csl-entry" role="listitem">
Bonan, Gordon. 2015. <em>Ecological Climatology: Concepts and Applications</em>. 3rd ed. Cambridge University Press.
</div>
<div id="ref-chelsa_bioclim" class="csl-entry" role="listitem">
Brun, Philipp, Niklaus E. Zimmermann, Chantal Hari, Loïc Pellissier, and Dirk Nikolaus Karger. 2022. <span>“CHELSA-BIOCLIM+ a Novel Set of Global Climate-Related Predictors at Kilometre-Resolution.”</span> EnviDat. https://doi.org/<a href="http://dx.doi.org/10.16904/envidat.332">http://dx.doi.org/10.16904/envidat.332</a>.
</div>
<div id="ref-davis17gmd" class="csl-entry" role="listitem">
Davis, T. W., I. C. Prentice, B. D. Stocker, R. T. Thomas, R. J. Whitley, H. Wang, B. J. Evans, A. V. Gallego-Sala, M. T. Sykes, and W. Cramer. 2017. <span>“Simple Process-Led Algorithms for Simulating Habitats (<span>SPLASH</span> v.1.0): Robust Indices of Radiation, Evapotranspiration and Plant-Available Moisture.”</span> <em>Geoscientific Model Development</em> 10 (2): 689–708. <a href="https://doi.org/10.5194/gmd-10-689-2017">https://doi.org/10.5194/gmd-10-689-2017</a>.
</div>
<div id="ref-duursma15plosone" class="csl-entry" role="listitem">
Duursma, Remko A. 2015. <span>“Plantecophys - <span>An</span> <span>R</span> <span>Package</span> for <span>Analysing</span> and <span>Modelling</span> <span>Leaf</span> <span>Gas</span> <span>Exchange</span> <span>Data</span>.”</span> Edited by Paul C. Struik. <em>PLOS ONE</em> 10 (11): e0143346. <a href="https://doi.org/10.1371/journal.pone.0143346">https://doi.org/10.1371/journal.pone.0143346</a>.
</div>
<div id="ref-farquhar80" class="csl-entry" role="listitem">
Farquhar, G D, S von Caemmerer, and J A Berry. 1980. <span>“A Biochemical Model of Photosynthetic <span>CO2</span> Assimilation in Leaves of <span>C</span> 3 Species.”</span> <em>Planta</em> 149 (1): 78–90.
</div>
<div id="ref-IPCC_2021_WGI_Ch_2" class="csl-entry" role="listitem">
Gulev, S. K., P. W. Thorne, J. Ahn, F. J. Dentener, C. M. Domingues, S. Gerland, D. Gong, et al. 2021. <span>“Changing State of the Climate System.”</span> Book Section. In <em>Climate Change 2021: The Physical Science Basis. Contribution of Working Group i to the Sixth Assessment Report of the Intergovernmental Panel on Climate Change</em>, edited by V. Masson-Delmotte, P. Zhai, A. Pirani, S. L. Connors, C. Péan, S. Berger, N. Caud, et al. Cambridge, UK; New York, NY, USA: Cambridge University Press. <a href="https://doi.org/10.1017/9781009157896.004">https://doi.org/10.1017/9781009157896.004</a>.
</div>
<div id="ref-IPCC_2021_WGI_SPM" class="csl-entry" role="listitem">
IPCC. 2021. <span>“Summary for Policymakers.”</span> Book Section. In <em>Climate Change 2021: The Physical Science Basis. Contribution of Working Group i to the Sixth Assessment Report of the Intergovernmental Panel on Climate Change</em>, edited by V. Masson-Delmotte, P. Zhai, A. Pirani, S. L. Connors, C. Péan, S. Berger, N. Caud, et al. Cambridge, UK; New York, NY, USA: Cambridge University Press. <a href="https://doi.org/10.1017/9781009157896.001">https://doi.org/10.1017/9781009157896.001</a>.
</div>
<div id="ref-lambers08" class="csl-entry" role="listitem">
Lambers, Hans, F. Stuart Chapin, and Thijs L. Pons. 2008. <span>“Photosynthesis.”</span> In <em>Plant <span>Physiological</span> <span>Ecology</span></em>, edited by Hans Lambers, F. Stuart Chapin, and Thijs L. Pons, 11–99. New York, NY: Springer. <a href="https://doi.org/10.1007/978-0-387-78341-3_2">https://doi.org/10.1007/978-0-387-78341-3_2</a>.
</div>
<div id="ref-macdonald00qr" class="csl-entry" role="listitem">
MacDonald, Glen M., Andrei A. Velichko, Constantine V. Kremenetski, Olga K. Borisova, Aleksandra A. Goleva, Andrei A. Andreev, Les C. Cwynar, et al. 2000. <span>“Holocene <span>Treeline</span> <span>History</span> and <span>Climate</span> <span>Change</span> <span>Across</span> <span>Northern</span> <span>Eurasia</span>.”</span> <em>Quaternary Research</em> 53 (3): 302–11. <a href="https://doi.org/10.1006/qres.1999.2123">https://doi.org/10.1006/qres.1999.2123</a>.
</div>
<div id="ref-monteith72" class="csl-entry" role="listitem">
Monteith, J. L. 1972. <span>“Solar <span>Radiation</span> and <span>Productivity</span> in <span>Tropical</span> <span>Ecosystems</span>.”</span> <em>Journal of Applied Ecology</em> 9 (3): 747–66. <a href="http://www.jstor.org/stable/2401901">http://www.jstor.org/stable/2401901</a>.
</div>
<div id="ref-prentice00biome" class="csl-entry" role="listitem">
Prentice, I Colin, D. Jolly, and BIOME 6000 Participants. 2000. <span>“Mid-<span>Holocene</span> and <span>Glacial</span>-<span>Maximum</span> <span>Vegetation</span> <span>Geography</span> of the <span>Northern</span> <span>Continents</span> and <span>Africa</span>.”</span> <em>Journal of Biogeography</em> 27 (3): 507–19. <a href="http://www.jstor.org/stable/2656208">http://www.jstor.org/stable/2656208</a>.
</div>
<div id="ref-stocker20gmd" class="csl-entry" role="listitem">
Stocker, Benjamin D., Han Wang, Nicholas G. Smith, Sandy P. Harrison, Trevor F. Keenan, David Sandoval, Tyler Davis, and I. Colin Prentice. 2020. <span>“P-Model V1.0: An Optimality-Based Light Use Efficiency Model for Simulating Ecosystem Gross Primary Production.”</span> <em>Geoscientific Model Development</em> 13 (3): 1545–81. <a href="https://doi.org/10.5194/gmd-13-1545-2020">https://doi.org/10.5194/gmd-13-1545-2020</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./carboncycle_1.html" class="pagination-link  aria-label=" &lt;span="" carbon="" pools="" and="" fluxes&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Global carbon pools and fluxes</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./carboncycle_3.html" class="pagination-link" aria-label="<span class='chapter-number'>5</span>&nbsp; <span class='chapter-title'>Ocean CO~2~ uptake and emission-concentration trajectories</span>">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Ocean CO<sub>2</sub> uptake and emission-concentration trajectories</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>